<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Part 2] How to setup alertmanager and send alerts ? | ashish.one</title><meta name=keywords content="prometheus,alertmanager"><meta name=description content="Introduction In PART - 1, We have successfully setup Prometheus and exporters. In this part, we are going to setup alertmanager and will send our first alert.
Alertmanager is software that is maintained by the prometheus and it is written in Go. It takes care of deduplicating, grouping, and routing them to the correct receiver integration such as email, PagerDuty, or OpsGenie. It also takes care of silencing and inhibition of alerts."><meta name=author content="Ashish Tiwari"><link rel=canonical href=https://ashish.one/blogs/setup-alertmanager/><link crossorigin=anonymous href=https://ashish.one/assets/css/stylesheet.ba7b1a0e212a12ce4d86f957158b1ebf0c5d1a6c7ad2b8d146953d5e6efa5beb.css integrity="sha256-unsaDiEqEs5NhvlXFYsevwxdGmx60rjRRpU9Xm76W+s=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=https://ashish.one/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ashish.one/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://ashish.one/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://ashish.one/favicon.png><link rel=apple-touch-icon href=https://ashish.one/favicon.png><link rel=mask-icon href=https://ashish.one/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-149424518-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="[Part 2] How to setup alertmanager and send alerts ?"><meta property="og:description" content="Introduction In PART - 1, We have successfully setup Prometheus and exporters. In this part, we are going to setup alertmanager and will send our first alert.
Alertmanager is software that is maintained by the prometheus and it is written in Go. It takes care of deduplicating, grouping, and routing them to the correct receiver integration such as email, PagerDuty, or OpsGenie. It also takes care of silencing and inhibition of alerts."><meta property="og:type" content="article"><meta property="og:url" content="https://ashish.one/blogs/setup-alertmanager/"><meta property="og:image" content="https://www.gravatar.com/avatar/dcb52889deff3e5017a18de40c57add8?s=200"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2019-10-23T15:24:26+05:30"><meta property="article:modified_time" content="2022-05-11T13:39:05+05:30"><meta property="og:site_name" content="ashish.one"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.gravatar.com/avatar/dcb52889deff3e5017a18de40c57add8?s=200"><meta name=twitter:title content="[Part 2] How to setup alertmanager and send alerts ?"><meta name=twitter:description content="Introduction In PART - 1, We have successfully setup Prometheus and exporters. In this part, we are going to setup alertmanager and will send our first alert.
Alertmanager is software that is maintained by the prometheus and it is written in Go. It takes care of deduplicating, grouping, and routing them to the correct receiver integration such as email, PagerDuty, or OpsGenie. It also takes care of silencing and inhibition of alerts."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://ashish.one/blogs/"},{"@type":"ListItem","position":2,"name":"[Part 2] How to setup alertmanager and send alerts ?","item":"https://ashish.one/blogs/setup-alertmanager/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Part 2] How to setup alertmanager and send alerts ?","name":"[Part 2] How to setup alertmanager and send alerts ?","description":"Introduction In PART - 1, We have successfully setup Prometheus and exporters. In this part, we are going to setup alertmanager and will send our first alert.\nAlertmanager is software that is maintained by the prometheus and it is written in Go. It takes care of deduplicating, grouping, and routing them to the correct receiver integration such as email, PagerDuty, or OpsGenie. It also takes care of silencing and inhibition of alerts.","keywords":["prometheus","alertmanager"],"articleBody":"Introduction In PART - 1, We have successfully setup Prometheus and exporters. In this part, we are going to setup alertmanager and will send our first alert.\nAlertmanager is software that is maintained by the prometheus and it is written in Go. It takes care of deduplicating, grouping, and routing them to the correct receiver integration such as email, PagerDuty, or OpsGenie. It also takes care of silencing and inhibition of alerts.\nLetâ€™s setup alertmanage: )\nSetup Alertmanager Installation: Prerequisites will be the same as PART - 1 . We will download the precompiled binary of alertmanager. Although there is a docker image also available which you can use.\nStep 1: Download alertmanager $ wget https://github.com/prometheus/prometheus/releases/download/v2.13.1/prometheus-2.13.1.linux-amd64.tar.gz Step 2: Extract tar $ tar -xvzf alertmanager-0.19.0.linux-amd64.tar.gz Step 3: Folder structure $ mv alertmanager-0.19.0.linux-amd64 alertmanager $ cd alertmanager/ $ ll Folder contains below files:\nalertmanager: It is a binary file that is core Daemon of alertmanager. alertmanager.yml: This is config file for alertmanager service. amtool: It is another binary that can be used as a command line utility to manager or silence the alerts on alertmanager. Step 4: Run alertmanager Execute binary:\n./alertmanager Visit to localhost:9093 on your browser:\nYour alertmanager is up :) Like prometheus it is creating folder with the name data. Alertmanager starts storing data in /data folder.\nTo check alertmanager metrics just visit localhost:9093/metrics\nMy production execution command is\n~/alertmanager/alertmanager --config.file=~/alertmanager/alertmanager.yml --storage.path=/var/lib/alertmanager --web.external-url=http://myurl.com:9093 --storage.tsdb.path : Specify the path where you want to save prometheus data. --web.external-url : You can use this option if you want to bind your address with your URL. Step 5: Run alertmanager as service Create file vim /etc/systemd/system/alertmanager.service Paste Below code [Unit] Description=AlertManager Server Service Wants=network-online.target After=network-online.target [Service] User=root Type=Simple ExecStart=~/alertmanager/alertmanager --config.file=~/alertmanager/alertmanager.yml --storage.path=/var/lib/alertmanager --web.external-url=http://myurl.com:9093 [Install] WantedBy=multi-user.target Save and exit.\nIt wonâ€™t run because alertmanager.yml is not defined yet. alertmanager.yml file is defined below.\nReload the Systemctl Daemon: $ sudo systemctl daemon-reload To start alertmanager service $ sudo systemctl start alertmanager Setup Alerts Step 1: Add settings in prometheus.yml Open prometheus.yml file\n$ vim ~/prometheus/prometheus.yml Add below code\nscrape_configs: # The job name is added as a label `job=` to any timeseries scraped from this config. - job_name: 'prometheus' # metrics_path defaults to '/metrics' # scheme defaults to 'http'. static_configs: - targets: ['localhost:9090'] # Add below block for node_exporter - job_name: node_exporter scrape_interval: 1m scrape_timeout: 1m metrics_path: \"/metrics\" static_configs: - targets: ['localhost:9100'] #Alertmanager settings rule_files: - '~/prometheus/alert.rules.yml' alerting: alertmanagers: - static_configs: - targets: - 'myurl.com:9093' rule_files: These are the files that contain all kinds of rules. Prometheus has own syntax to define rules. We will see this below.\nalerting: This is an option where we have to define alertmanager configuration. In target, we have defined myurl.com:9093 this is the exact port where our alertmanager is running.\nStep 2: How prometheus service will work? In above scrape_config we have defined scrape configurations. In the above example, prometheus will scrape node_exporter job at every 1 minute (scrape_interval is 1m. it will scrape all information which is available on localhost:9100/metrics (It will scrape all targets which is defined in the targets array).\nIt will store the data in the Internal database.\nAt every scraping, it will keep evaluating alert rules which defined in alert.rules.yml. As soon as any alert rules get true it will send an event to alertmanager on myurl.com:9093\nOnce alertmanager received events, It will check by which channel alert needs to be trigger like via slack, email pagerduty, etc which defined in alertmanager.yml \u0026 it will trigger an alert via appropriate channel. Now letâ€™s define two files :\nalert.rules.yml alertmanager.yml Step 3: Create alert.rules.yml Create ~/prometheus/alert.rules.yml file and paste below sample rule:\ngroups: - name: Disk-usage rules: - alert: 'Low data disk space' expr: ceil(((node_filesystem_size_bytes{mountpoint!=\"/boot\"} - node_filesystem_free_bytes{mountpoint!=\"/boot\"}) / node_filesystem_size_bytes{mountpoint!=\"/boot\"} * 100)) \u003e 95 labels: severity: 'critical' annotations: title: \"Disk Usage\" description: 'Partition : {{$labels.mountpoint}}' summary: \"Disk usage is `{{humanize $value}}%`\" host: \"{{$labels.instance}}\" - name: Memory-usage rules: - alert: 'High memory usage' expr: ceil((((node_memory_MemTotal_bytes - node_memory_MemFree_bytes - node_memory_Buffers_bytes - node_memory_Cached_bytes) / node_memory_MemTotal_bytes) * 100)) \u003e 80 labels: severity: 'critical' annotations: title: \"Memory Usage\" description: 'Memory usage threshold set to `80%`.' summary: \"Memory usage is `{{humanize $value}}%`\" host: \"{{$labels.instance}}\" Here we have defined two rules.\nIf memory utilization is exceeded than 80% then it will trigger an email. If any disk partition usage exceeded than 95% then it will trigger an email. You will get more insights on defining alerting rules here.\nNow you might be wondering what is node_filesystem_size_bytes or node_memory_MemTotal_bytes ?\nIf we recall part - 1 when we set up the node exporter and visited on localhost:9100/metrics, It has shown some metric. In that will get the above variable name. If you want to put any alert rules irrespective of any exporters, You have to make expr using these variables.\nYou can compile your alert rule file :\n$ promtool check rules alert.rules.yml promtool is binary which we got in prometheus folder when we extracted it.\nYou can explore some sample rules here.\nStep 4: Create alertmanager.yml Create ~/alertmanager/alertmanager.yml file and paste below code:\nglobal: slack_api_url: \"https://hooks.slack.com/services/XXXXXXXXXXXXXXX\" route: receiver: \"default\" routes: - match: severity: info receiver: slack - match: severity: critical receiver: email group_wait: 30s group_interval: 5m repeat_interval: 5m receivers: - name: default email_configs: - to: 'to@youremail.com' from: 'default-alerts@yourdomain.com' smarthost: 'smtp.host.com:2525' auth_username: \"smtpusername\" auth_password: \"smtppassword\" html: '{{ template \"email\" .}}' - name: slack slack_configs: - send_resolved: true username: '{{ template \"slack.default.username\" . }}' color: '{{ if eq .Status \"firing\" }}good{{ else }}good{{ end }}' title: '{{ template \"slack.default.title\" . }}' title_link: '{{ template \"slack.default.titlelink\" . }}' pretext: '{{ .CommonAnnotations.summary }}' text: \u003e- {{ range .Alerts }} *Alert:* {{ .Annotations.summary }} - `{{ .Labels.severity }}`ðŸ“Š *Description:* {{ .Annotations.description }} *Details:* {{ range .Labels.SortedPairs }} â€¢ *{{ .Name }}:* `{{ .Value }}` {{ end }} {{ end }} - name: email email_configs: - to: 'to@youremail.com' from: 'default-alerts@yourdomain.com' smarthost: 'smtp.host.com:2525' auth_username: \"smtpusername\" auth_password: \"smtppassword\" html: '{{ template \"email\" .}}' templates: - '~/prometheus/alert.tmpl' Here we have setup two channel email and slack for alert. if you see alertmanager.yml file, There are four main components I defined.\nglobal: Here we can define any global variable like we defined slack_api_url. route: It is a routing block. I am playing routing on severity. Similarly, it is your choice on which variable you want to route your alerts. So here if severity == â€˜infoâ€™, Alert will go from slack or if severity == â€˜criticalâ€™, Alert will go via an email. receivers: Here we can define the channel by which alert will go. For now, I have defined only email \u0026 slack. You can explore more receivers here. templates: It is an alert template where I have defined the HTML template for an email alert. It is not restricted to email. You can define a template for any channel. Explore more details about templates here. Step 5: Sample template Create and Paste below code in ~/prometheus/alert.tmpl\n{{ define \"email\" }} ","wordCount":"1351","inLanguage":"en","datePublished":"2019-10-23T15:24:26+05:30","dateModified":"2022-05-11T13:39:05+05:30","author":{"@type":"Person","name":"Ashish Tiwari"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ashish.one/blogs/setup-alertmanager/"},"publisher":{"@type":"Organization","name":"ashish.one","logo":{"@type":"ImageObject","url":"https://ashish.one/favicon.png"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ashish.one/ accesskey=h title="Ashish Tiwari (Alt + H)">Ashish Tiwari</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ashish.one/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://ashish.one/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://ashish.one/talks/ title=Talks><span>Talks</span></a></li><li><a href=https://ashish.one/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ashish.one/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ashish.one/>Home</a>&nbsp;Â»&nbsp;<a href=https://ashish.one/blogs/>Blogs</a></div><h1 class=post-title>[Part 2] How to setup alertmanager and send alerts ?</h1><div class=post-meta><span title='2019-10-23 15:24:26 +0530 IST'>October 23, 2019</span>&nbsp;Â·&nbsp;7 min&nbsp;Â·&nbsp;Ashish Tiwari&nbsp;|&nbsp;<a href=https://github.com/ashishtiwari1993/ashish.one/tree/master/content/blogs/setup-alertmanager-part2.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#setup-alertmanager aria-label="Setup Alertmanager">Setup Alertmanager</a><ul><li><a href=#installation aria-label=Installation:>Installation:</a><ul><li><a href=#step-1-download-alertmanager aria-label="Step 1: Download alertmanager">Step 1: Download alertmanager</a></li><li><a href=#step-2-extract-tar aria-label="Step 2: Extract tar">Step 2: Extract tar</a></li><li><a href=#step-3-folder-structure aria-label="Step 3: Folder structure">Step 3: Folder structure</a></li><li><a href=#step--4-run-alertmanager aria-label="Step  4: Run alertmanager">Step 4: Run alertmanager</a></li><li><a href=#step-5-run-alertmanager-as-service aria-label="Step 5: Run alertmanager as service">Step 5: Run alertmanager as service</a></li></ul></li><li><a href=#setup-alerts aria-label="Setup Alerts">Setup Alerts</a><ul><li><a href=#step-1-add-settings-in-prometheusyml aria-label="Step 1: Add settings in prometheus.yml">Step 1: Add settings in <code>prometheus.yml</code></a></li><li><a href=#step-2-how-prometheus-service-will-work aria-label="Step 2: How prometheus service will work?">Step 2: How prometheus service will work?</a></li><li><a href=#step-3-create-alertrulesyml aria-label="Step 3: Create alert.rules.yml">Step 3: Create <code>alert.rules.yml</code></a></li><li><a href=#step-4-create-alertmanageryml aria-label="Step 4: Create alertmanager.yml">Step 4: Create alertmanager.yml</a></li><li><a href=#step-5-sample-template aria-label="Step 5: Sample template">Step 5: Sample template</a></li><li><a href=#step-6-start-alertmanager-service--restart-prometheus aria-label="Step 6: Start alertmanager service &amp;amp; restart prometheus">Step 6: Start alertmanager service & restart prometheus</a></li></ul></li><li><a href=#test-complete-integration aria-label="Test complete Integration:">Test complete Integration:</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>In <a href=https://ashish.one/blogs/setup-prometheus-and-exporters/>PART - 1</a>, We have successfully setup Prometheus and exporters. In this part, we are going to setup alertmanager and will send our first alert.</p><p>Alertmanager is software that is maintained by the prometheus and it is written in Go. It takes care of deduplicating, grouping, and routing them to the correct receiver integration such as email, PagerDuty, or OpsGenie. It also takes care of silencing and inhibition of alerts.</p><p>Let&rsquo;s setup alertmanage: )</p><h1 id=setup-alertmanager>Setup Alertmanager<a hidden class=anchor aria-hidden=true href=#setup-alertmanager>#</a></h1><h2 id=installation>Installation:<a hidden class=anchor aria-hidden=true href=#installation>#</a></h2><p>Prerequisites will be the same as <a href=https://ashish.one/blogs/setup-prometheus-and-exporters/>PART - 1</a> . We will download the precompiled binary of alertmanager. Although there is a docker image also available which you can use.</p><h3 id=step-1-download-alertmanager>Step 1: Download alertmanager<a hidden class=anchor aria-hidden=true href=#step-1-download-alertmanager>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ wget https://github.com/prometheus/prometheus/releases/download/v2.13.1/prometheus-2.13.1.linux-amd64.tar.gz
</span></span></code></pre></div><p><img loading=lazy src=https://ashish.one/img/alertmanager-setup/download_alertmanager.png alt="alertmanager binary download"></p><h3 id=step-2-extract-tar>Step 2: Extract tar<a hidden class=anchor aria-hidden=true href=#step-2-extract-tar>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ tar -xvzf alertmanager-0.19.0.linux-amd64.tar.gz
</span></span></code></pre></div><h3 id=step-3-folder-structure>Step 3: Folder structure<a hidden class=anchor aria-hidden=true href=#step-3-folder-structure>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ mv alertmanager-0.19.0.linux-amd64 alertmanager
</span></span><span style=display:flex><span>$ cd alertmanager/
</span></span><span style=display:flex><span>$ ll
</span></span></code></pre></div><p>Folder contains below files:</p><p><img loading=lazy src=https://ashish.one/img/alertmanager-setup/folder_structure.png alt="alertmanager folder structure"></p><ul><li><code>alertmanager</code>: It is a binary file that is core Daemon of alertmanager.</li><li><code>alertmanager.yml</code>: This is config file for alertmanager service.</li><li><code>amtool</code>: It is another binary that can be used as a command line utility to manager or silence the alerts on alertmanager.</li></ul><h3 id=step--4-run-alertmanager>Step 4: Run alertmanager<a hidden class=anchor aria-hidden=true href=#step--4-run-alertmanager>#</a></h3><p>Execute binary:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>./alertmanager
</span></span></code></pre></div><p><img loading=lazy src=https://ashish.one/img/alertmanager-setup/execute_alertmanager.png alt="alertmanager folder structure"></p><p>Visit to <code>localhost:9093</code> on your browser:</p><p><img loading=lazy src=https://ashish.one/img/alertmanager-setup/alertmanager_web.png alt="alertmanager web"></p><p>Your alertmanager is up :) Like prometheus it is creating folder with the name <code>data</code>. Alertmanager starts storing data in <code>/data</code> folder.</p><p>To check alertmanager metrics just visit <code>localhost:9093/metrics</code></p><p>My production execution command is</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>~/alertmanager/alertmanager --config.file<span style=color:#f92672>=</span>~/alertmanager/alertmanager.yml --storage.path<span style=color:#f92672>=</span>/var/lib/alertmanager --web.external-url<span style=color:#f92672>=</span>http://myurl.com:9093
</span></span></code></pre></div><ul><li><code>--storage.tsdb.path</code> : Specify the path where you want to save prometheus data.</li><li><code>--web.external-url</code> : You can use this option if you want to bind your address with your URL.</li></ul><h3 id=step-5-run-alertmanager-as-service>Step 5: Run alertmanager as service<a hidden class=anchor aria-hidden=true href=#step-5-run-alertmanager-as-service>#</a></h3><ol><li>Create file</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>vim /etc/systemd/system/alertmanager.service
</span></span></code></pre></div><ol start=2><li>Paste Below code</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#f92672>[</span>Unit<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Description<span style=color:#f92672>=</span>AlertManager Server Service
</span></span><span style=display:flex><span>Wants<span style=color:#f92672>=</span>network-online.target
</span></span><span style=display:flex><span>After<span style=color:#f92672>=</span>network-online.target
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Service<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>User<span style=color:#f92672>=</span>root
</span></span><span style=display:flex><span>Type<span style=color:#f92672>=</span>Simple
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ExecStart<span style=color:#f92672>=</span>~/alertmanager/alertmanager --config.file<span style=color:#f92672>=</span>~/alertmanager/alertmanager.yml --storage.path<span style=color:#f92672>=</span>/var/lib/alertmanager --web.external-url<span style=color:#f92672>=</span>http://myurl.com:9093
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Install<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>WantedBy<span style=color:#f92672>=</span>multi-user.target
</span></span></code></pre></div><p>Save and exit.</p><p>It wonâ€™t run because <code>alertmanager.yml</code> is not defined yet. <code>alertmanager.yml</code> file is defined below.</p><ol start=3><li>Reload the Systemctl Daemon:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ sudo systemctl daemon-reload
</span></span></code></pre></div><ol start=4><li>To start alertmanager service</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ sudo systemctl start alertmanager
</span></span></code></pre></div><h2 id=setup-alerts>Setup Alerts<a hidden class=anchor aria-hidden=true href=#setup-alerts>#</a></h2><h3 id=step-1-add-settings-in-prometheusyml>Step 1: Add settings in <code>prometheus.yml</code><a hidden class=anchor aria-hidden=true href=#step-1-add-settings-in-prometheusyml>#</a></h3><p>Open <code>prometheus.yml</code> file</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ vim ~/prometheus/prometheus.yml
</span></span></code></pre></div><p>Add below code</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>scrape_configs:
</span></span><span style=display:flex><span>  <span style=color:#75715e># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span>
</span></span><span style=display:flex><span>  - job_name: <span style=color:#e6db74>&#39;prometheus&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># metrics_path defaults to &#39;/metrics&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># scheme defaults to &#39;http&#39;.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    static_configs:
</span></span><span style=display:flex><span>    - targets: <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;localhost:9090&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Add below block for node_exporter</span>
</span></span><span style=display:flex><span>  - job_name: node_exporter
</span></span><span style=display:flex><span>    scrape_interval: 1m
</span></span><span style=display:flex><span>    scrape_timeout:  1m
</span></span><span style=display:flex><span>    metrics_path: <span style=color:#e6db74>&#34;/metrics&#34;</span>
</span></span><span style=display:flex><span>    static_configs:
</span></span><span style=display:flex><span>    - targets: <span style=color:#f92672>[</span><span style=color:#e6db74>&#39;localhost:9100&#39;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Alertmanager settings</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rule_files:
</span></span><span style=display:flex><span>  - <span style=color:#e6db74>&#39;~/prometheus/alert.rules.yml&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>alerting:
</span></span><span style=display:flex><span>  alertmanagers:
</span></span><span style=display:flex><span>  - static_configs:
</span></span><span style=display:flex><span>    - targets:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#39;myurl.com:9093&#39;</span>
</span></span></code></pre></div><ul><li><p><code>rule_files</code>: These are the files that contain all kinds of rules. Prometheus has own syntax to define rules. We will see this below.</p></li><li><p><code>alerting</code>: This is an option where we have to define alertmanager configuration. In target, we have defined <code>myurl.com:9093</code> this is the exact port where our alertmanager is running.</p></li></ul><h3 id=step-2-how-prometheus-service-will-work>Step 2: How prometheus service will work?<a hidden class=anchor aria-hidden=true href=#step-2-how-prometheus-service-will-work>#</a></h3><p>In above <code>scrape_config</code> we have defined scrape configurations. In the above example, prometheus will scrape <code>node_exporter</code> job at every 1 minute (scrape_interval is 1m. it will scrape all information which is available on <code>localhost:9100/metrics</code> (It will scrape all targets which is defined in the <code>targets</code> array).</p><p>It will store the data in the Internal database.</p><p>At every scraping, it will keep evaluating alert rules which defined in <code>alert.rules.yml</code>. As soon as any alert rules get true it will send an event to alertmanager on <code>myurl.com:9093</code></p><p>Once alertmanager received events, It will check by which channel alert needs to be trigger like via slack, email pagerduty, etc which defined in <code>alertmanager.yml</code> & it will trigger an alert via appropriate channel. Now letâ€™s define two files :</p><ol><li><code>alert.rules.yml</code></li><li><code>alertmanager.yml</code></li></ol><h3 id=step-3-create-alertrulesyml>Step 3: Create <code>alert.rules.yml</code><a hidden class=anchor aria-hidden=true href=#step-3-create-alertrulesyml>#</a></h3><p>Create <code>~/prometheus/alert.rules.yml</code> file and paste below sample rule:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>groups:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- name: Disk-usage
</span></span><span style=display:flex><span>  rules:
</span></span><span style=display:flex><span>  - alert: <span style=color:#e6db74>&#39;Low data disk space&#39;</span>
</span></span><span style=display:flex><span>    expr: ceil<span style=color:#f92672>(((</span>node_filesystem_size_bytes<span style=color:#f92672>{</span>mountpoint!<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/boot&#34;</span><span style=color:#f92672>}</span> - node_filesystem_free_bytes<span style=color:#f92672>{</span>mountpoint!<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/boot&#34;</span><span style=color:#f92672>})</span> / node_filesystem_size_bytes<span style=color:#f92672>{</span>mountpoint!<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/boot&#34;</span><span style=color:#f92672>}</span> * 100<span style=color:#f92672>))</span> &gt; <span style=color:#ae81ff>95</span>
</span></span><span style=display:flex><span>    labels:
</span></span><span style=display:flex><span>      severity: <span style=color:#e6db74>&#39;critical&#39;</span>
</span></span><span style=display:flex><span>    annotations:
</span></span><span style=display:flex><span>      title: <span style=color:#e6db74>&#34;Disk Usage&#34;</span>
</span></span><span style=display:flex><span>      description: <span style=color:#e6db74>&#39;Partition : {{$labels.mountpoint}}&#39;</span>
</span></span><span style=display:flex><span>      summary: <span style=color:#e6db74>&#34;Disk usage is `{{humanize </span>$value<span style=color:#e6db74>}}%`&#34;</span>
</span></span><span style=display:flex><span>      host: <span style=color:#e6db74>&#34;{{</span>$labels<span style=color:#e6db74>.instance}}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- name: Memory-usage
</span></span><span style=display:flex><span>  rules:
</span></span><span style=display:flex><span>  - alert: <span style=color:#e6db74>&#39;High memory usage&#39;</span>
</span></span><span style=display:flex><span>    expr: ceil<span style=color:#f92672>((((</span>node_memory_MemTotal_bytes - node_memory_MemFree_bytes - node_memory_Buffers_bytes - node_memory_Cached_bytes<span style=color:#f92672>)</span> / node_memory_MemTotal_bytes<span style=color:#f92672>)</span> * 100<span style=color:#f92672>))</span> &gt; <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>    labels:
</span></span><span style=display:flex><span>      severity: <span style=color:#e6db74>&#39;critical&#39;</span>
</span></span><span style=display:flex><span>    annotations:
</span></span><span style=display:flex><span>      title: <span style=color:#e6db74>&#34;Memory Usage&#34;</span>
</span></span><span style=display:flex><span>      description: <span style=color:#e6db74>&#39;Memory usage threshold set to `80%`.&#39;</span>
</span></span><span style=display:flex><span>      summary: <span style=color:#e6db74>&#34;Memory usage is `{{humanize </span>$value<span style=color:#e6db74>}}%`&#34;</span>
</span></span><span style=display:flex><span>      host: <span style=color:#e6db74>&#34;{{</span>$labels<span style=color:#e6db74>.instance}}&#34;</span>
</span></span></code></pre></div><p>Here we have defined two rules.</p><ol><li>If memory utilization is exceeded than 80% then it will trigger an email.</li><li>If any disk partition usage exceeded than 95% then it will trigger an email.</li></ol><p>You will get more insights on defining alerting rules <a href=https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/>here</a>.</p><p>Now you might be wondering what is <code>node_filesystem_size_bytes</code> or <code>node_memory_MemTotal_bytes</code> ?</p><p>If we recall part - 1 when we set up the node exporter and visited on <code>localhost:9100/metrics</code>, It has shown some metric. In that will get the above variable name. If you want to put any alert rules irrespective of any exporters, You have to make <code>expr</code> using these variables.</p><p>You can compile your alert rule file :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ promtool check rules alert.rules.yml
</span></span></code></pre></div><p><code>promtool</code> is binary which we got in prometheus folder when we extracted it.</p><p>You can explore some sample rules <a href=https://awesome-prometheus-alerts.grep.to/rules.html>here</a>.</p><h3 id=step-4-create-alertmanageryml>Step 4: Create alertmanager.yml<a hidden class=anchor aria-hidden=true href=#step-4-create-alertmanageryml>#</a></h3><p>Create <code>~/alertmanager/alertmanager.yml</code> file and paste below code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>global:
</span></span><span style=display:flex><span>  slack_api_url: <span style=color:#e6db74>&#34;https://hooks.slack.com/services/XXXXXXXXXXXXXXX&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>route:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  receiver: <span style=color:#e6db74>&#34;default&#34;</span>
</span></span><span style=display:flex><span>  routes:
</span></span><span style=display:flex><span>   - match:
</span></span><span style=display:flex><span>      severity: info
</span></span><span style=display:flex><span>     receiver: slack
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   - match:
</span></span><span style=display:flex><span>      severity: critical
</span></span><span style=display:flex><span>     receiver: email
</span></span><span style=display:flex><span>     group_wait: 30s
</span></span><span style=display:flex><span>     group_interval: 5m
</span></span><span style=display:flex><span>     repeat_interval: 5m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>receivers:
</span></span><span style=display:flex><span>  - name: default
</span></span><span style=display:flex><span>    email_configs:
</span></span><span style=display:flex><span>     - to: <span style=color:#e6db74>&#39;to@youremail.com&#39;</span>
</span></span><span style=display:flex><span>       from: <span style=color:#e6db74>&#39;default-alerts@yourdomain.com&#39;</span>
</span></span><span style=display:flex><span>       smarthost: <span style=color:#e6db74>&#39;smtp.host.com:2525&#39;</span>
</span></span><span style=display:flex><span>       auth_username: <span style=color:#e6db74>&#34;smtpusername&#34;</span>
</span></span><span style=display:flex><span>       auth_password: <span style=color:#e6db74>&#34;smtppassword&#34;</span>
</span></span><span style=display:flex><span>       html: <span style=color:#e6db74>&#39;{{ template &#34;email&#34; .}}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - name: slack
</span></span><span style=display:flex><span>    slack_configs:
</span></span><span style=display:flex><span>      - send_resolved: true
</span></span><span style=display:flex><span>        username: <span style=color:#e6db74>&#39;{{ template &#34;slack.default.username&#34; . }}&#39;</span>
</span></span><span style=display:flex><span>        color: <span style=color:#e6db74>&#39;{{ if eq .Status &#34;firing&#34; }}good{{ else }}good{{ end }}&#39;</span>
</span></span><span style=display:flex><span>        title: <span style=color:#e6db74>&#39;{{ template &#34;slack.default.title&#34; . }}&#39;</span>
</span></span><span style=display:flex><span>        title_link: <span style=color:#e6db74>&#39;{{ template &#34;slack.default.titlelink&#34; . }}&#39;</span>
</span></span><span style=display:flex><span>        pretext: <span style=color:#e6db74>&#39;{{ .CommonAnnotations.summary }}&#39;</span>
</span></span><span style=display:flex><span>        text:
</span></span><span style=display:flex><span>         &gt;-
</span></span><span style=display:flex><span>          <span style=color:#f92672>{{</span> range .Alerts <span style=color:#f92672>}}</span>
</span></span><span style=display:flex><span>           *Alert:* <span style=color:#f92672>{{</span> .Annotations.summary <span style=color:#f92672>}}</span> - <span style=color:#e6db74>`</span><span style=color:#f92672>{{</span> .Labels.severity <span style=color:#f92672>}}</span><span style=color:#e6db74>`</span>ðŸ“Š
</span></span><span style=display:flex><span>           *Description:* <span style=color:#f92672>{{</span> .Annotations.description <span style=color:#f92672>}}</span>
</span></span><span style=display:flex><span>           *Details:*
</span></span><span style=display:flex><span>           <span style=color:#f92672>{{</span> range .Labels.SortedPairs <span style=color:#f92672>}}</span> â€¢ *<span style=color:#f92672>{{</span> .Name <span style=color:#f92672>}}</span>:* <span style=color:#e6db74>`</span><span style=color:#f92672>{{</span> .Value <span style=color:#f92672>}}</span><span style=color:#e6db74>`</span>
</span></span><span style=display:flex><span>           <span style=color:#f92672>{{</span> end <span style=color:#f92672>}}</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>{{</span> end <span style=color:#f92672>}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  - name: email
</span></span><span style=display:flex><span>    email_configs:
</span></span><span style=display:flex><span>     - to: <span style=color:#e6db74>&#39;to@youremail.com&#39;</span>
</span></span><span style=display:flex><span>       from: <span style=color:#e6db74>&#39;default-alerts@yourdomain.com&#39;</span>
</span></span><span style=display:flex><span>       smarthost: <span style=color:#e6db74>&#39;smtp.host.com:2525&#39;</span>
</span></span><span style=display:flex><span>       auth_username: <span style=color:#e6db74>&#34;smtpusername&#34;</span>
</span></span><span style=display:flex><span>       auth_password: <span style=color:#e6db74>&#34;smtppassword&#34;</span>
</span></span><span style=display:flex><span>       html: <span style=color:#e6db74>&#39;{{ template &#34;email&#34; .}}&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>templates:
</span></span><span style=display:flex><span>- <span style=color:#e6db74>&#39;~/prometheus/alert.tmpl&#39;</span>
</span></span></code></pre></div><p>Here we have setup two channel email and slack for alert. if you see <code>alertmanager.yml</code> file, There are four main components I defined.</p><ul><li><code>global</code>: Here we can define any global variable like we defined <code>slack_api_url</code>.</li><li><code>route</code>: It is a routing block. I am playing routing on <code>severity</code>. Similarly, it is your choice on which variable you want to route your alerts. So here if <code>severity == â€˜infoâ€™</code>, Alert will go from slack or if <code>severity == â€˜criticalâ€™</code>, Alert will go via an email.</li><li><code>receivers</code>: Here we can define the channel by which alert will go. For now, I have defined only email & slack. You can explore more receivers <a href=https://prometheus.io/docs/alerting/configuration/#receiver>here</a>.</li><li><code>templates</code>: It is an alert template where I have defined the HTML template for an email alert. It is not restricted to email. You can define a template for any channel. Explore more details about templates <a href=https://prometheus.io/docs/alerting/notification_examples/>here</a>.</li></ul><h3 id=step-5-sample-template>Step 5: Sample template<a hidden class=anchor aria-hidden=true href=#step-5-sample-template>#</a></h3><p>Create and Paste below code in <code>~/prometheus/alert.tmpl</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#f92672>{{</span> define <span style=color:#e6db74>&#34;email&#34;</span> <span style=color:#f92672>}}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;html&gt;
</span></span><span style=display:flex><span>   &lt;head&gt;
</span></span><span style=display:flex><span>      &lt;style type<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/css&#34;</span>&gt;
</span></span><span style=display:flex><span>         table <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>         font-family: verdana,arial,sans-serif;
</span></span><span style=display:flex><span>         font-size:11px;
</span></span><span style=display:flex><span>         color:#333333;
</span></span><span style=display:flex><span>         border-width: 1px;
</span></span><span style=display:flex><span>         border-color: <span style=color:#75715e>#999999;</span>
</span></span><span style=display:flex><span>         border-collapse: collapse;
</span></span><span style=display:flex><span>         <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>         table th <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>         background-color:#ff6961;
</span></span><span style=display:flex><span>         border-width: 1px;
</span></span><span style=display:flex><span>         padding: 8px;
</span></span><span style=display:flex><span>         border-style: solid;
</span></span><span style=display:flex><span>         border-color: <span style=color:#75715e>#F54C44;</span>
</span></span><span style=display:flex><span>         <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>         table td <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>         border-width: 1px;
</span></span><span style=display:flex><span>         padding: 8px;
</span></span><span style=display:flex><span>         border-style: solid;
</span></span><span style=display:flex><span>         border-color: <span style=color:#75715e>#F54C44;</span>
</span></span><span style=display:flex><span>         text-align: right;
</span></span><span style=display:flex><span>         <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      &lt;/style&gt;
</span></span><span style=display:flex><span>   &lt;/head&gt;
</span></span><span style=display:flex><span>   &lt;body&gt;
</span></span><span style=display:flex><span>      &lt;table border<span style=color:#f92672>=</span>1&gt;
</span></span><span style=display:flex><span>         &lt;thead&gt;    
</span></span><span style=display:flex><span>           &lt;tr&gt;
</span></span><span style=display:flex><span>        &lt;th&gt;Alert name&lt;/th&gt;
</span></span><span style=display:flex><span>        &lt;th&gt;Host&lt;/th&gt;
</span></span><span style=display:flex><span>            &lt;th&gt;Summary&lt;/th&gt;
</span></span><span style=display:flex><span>            &lt;th&gt;Description&lt;/th&gt;
</span></span><span style=display:flex><span>           &lt;/tr&gt;
</span></span><span style=display:flex><span>         &lt;/thead&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         &lt;tbody&gt;
</span></span><span style=display:flex><span>       <span style=color:#f92672>{{</span> range .Alerts <span style=color:#f92672>}}</span>
</span></span><span style=display:flex><span>            &lt;tr&gt;
</span></span><span style=display:flex><span>         &lt;td&gt;<span style=color:#f92672>{{</span> .Labels.alertname <span style=color:#f92672>}}</span>&lt;/td&gt;
</span></span><span style=display:flex><span>         &lt;td&gt;<span style=color:#f92672>{{</span> .Annotations.host <span style=color:#f92672>}}</span>&lt;/td&gt;
</span></span><span style=display:flex><span>         &lt;td&gt;<span style=color:#f92672>{{</span> .Annotations.summary <span style=color:#f92672>}}</span>&lt;/td&gt;
</span></span><span style=display:flex><span>         &lt;td&gt;<span style=color:#f92672>{{</span> .Annotations.description <span style=color:#f92672>}}</span>&lt;/td&gt;
</span></span><span style=display:flex><span>           &lt;/tr&gt;
</span></span><span style=display:flex><span>          <span style=color:#f92672>{{</span> end <span style=color:#f92672>}}</span>
</span></span><span style=display:flex><span>         &lt;/tbody&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      &lt;/table&gt;
</span></span><span style=display:flex><span>  &lt;/body&gt;
</span></span><span style=display:flex><span>&lt;/html&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>{{</span>end<span style=color:#f92672>}}</span>
</span></span></code></pre></div><h3 id=step-6-start-alertmanager-service--restart-prometheus>Step 6: Start alertmanager service & restart prometheus<a hidden class=anchor aria-hidden=true href=#step-6-start-alertmanager-service--restart-prometheus>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ sudo systemctl start alertmanager
</span></span><span style=display:flex><span>$ sudo systemctl restart prometheus
</span></span></code></pre></div><h2 id=test-complete-integration>Test complete Integration:<a hidden class=anchor aria-hidden=true href=#test-complete-integration>#</a></h2><p>If everything is set up correctly and alert rule getting true then it will trigger an alert. You can enable the log of alertmanager for debugging purposes.</p><p>If you want to test alert, Then simply make threshold to very less 0% or 1% after 30s it should trigger the alert.</p><p>Visit <code>localhost:9093</code>. If there is some alert you will get the list on the dashboard.</p><p>So we successfully setup alert using alertmanager. In <a href=https://ashish.one/blogs/write-custom-exporters-prometheus/>part - 3</a> I have explained how you can write your own custom exporters & You can check <a href=https://ashish.one/blogs/setup-grafana-with-prometheus/>part - 4</a> to integrate Grafana with Prometheus.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ashish.one/tags/prometheus/>prometheus</a></li><li><a href=https://ashish.one/tags/alertmanager/>alertmanager</a></li></ul><nav class=paginav><a class=prev href=https://ashish.one/blogs/write-custom-exporters-prometheus/><span class=title>Â« Prev</span><br><span>[Part 3] How to write custom prometheus exporter?</span></a>
<a class=next href=https://ashish.one/blogs/setup-prometheus-and-exporters/><span class=title>Next Â»</span><br><span>[Part 1] How To Setup Prometheus And Exporters For Alerts And Monitoring?</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share [Part 2] How to setup alertmanager and send alerts ? on twitter" href="https://twitter.com/intent/tweet/?text=%5bPart%202%5d%20How%20to%20setup%20alertmanager%20and%20send%20alerts%20%3f&url=https%3a%2f%2fashish.one%2fblogs%2fsetup-alertmanager%2f&hashtags=prometheus%2calertmanager"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [Part 2] How to setup alertmanager and send alerts ? on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fashish.one%2fblogs%2fsetup-alertmanager%2f&title=%5bPart%202%5d%20How%20to%20setup%20alertmanager%20and%20send%20alerts%20%3f&summary=%5bPart%202%5d%20How%20to%20setup%20alertmanager%20and%20send%20alerts%20%3f&source=https%3a%2f%2fashish.one%2fblogs%2fsetup-alertmanager%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [Part 2] How to setup alertmanager and send alerts ? on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fashish.one%2fblogs%2fsetup-alertmanager%2f&title=%5bPart%202%5d%20How%20to%20setup%20alertmanager%20and%20send%20alerts%20%3f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [Part 2] How to setup alertmanager and send alerts ? on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fashish.one%2fblogs%2fsetup-alertmanager%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [Part 2] How to setup alertmanager and send alerts ? on whatsapp" href="https://api.whatsapp.com/send?text=%5bPart%202%5d%20How%20to%20setup%20alertmanager%20and%20send%20alerts%20%3f%20-%20https%3a%2f%2fashish.one%2fblogs%2fsetup-alertmanager%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [Part 2] How to setup alertmanager and send alerts ? on telegram" href="https://telegram.me/share/url?text=%5bPart%202%5d%20How%20to%20setup%20alertmanager%20and%20send%20alerts%20%3f&url=https%3a%2f%2fashish.one%2fblogs%2fsetup-alertmanager%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><script src=https://giscus.app/client.js data-repo=ashishtiwari1993/ashish.one data-repo-id="MDEwOlJlcG9zaXRvcnkyMTAxMjkzNjY=" data-category=General data-category-id=DIC_kwDODIZR1s4CP1P2 data-mapping=title data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=dark_high_contrast data-lang=en crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://ashish.one/>ashish.one</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>