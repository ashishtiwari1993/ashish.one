<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Part -1] Search as you type | ashish.one</title><meta name=keywords content="elasticsearch,search_as_you_type,Elastic"><meta name=description content="Introduction In this blog, we will try to understand how “Search as you type” works and Quickly setup one demo using some sample data. You must have seen various websites like eCommerce, food apps, etc. where you just start typing & simultaneously relevant options start displaying as suggestions and autocomplete. We will try to achieve somewhat the same feature. Search as you type Elasticsearch gives this specific mapping type which you can simply set to a specific field where you want to perform this kind of search."><meta name=author content="Ashish Tiwari"><link rel=canonical href=https://ashish.one/blogs/search-as-you-type/><link crossorigin=anonymous href=https://ashish.one/assets/css/stylesheet.ba7b1a0e212a12ce4d86f957158b1ebf0c5d1a6c7ad2b8d146953d5e6efa5beb.css integrity="sha256-unsaDiEqEs5NhvlXFYsevwxdGmx60rjRRpU9Xm76W+s=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=https://ashish.one/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ashish.one/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://ashish.one/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://ashish.one/favicon.png><link rel=apple-touch-icon href=https://ashish.one/favicon.png><link rel=mask-icon href=https://ashish.one/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-149424518-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="[Part -1] Search as you type"><meta property="og:description" content="Introduction In this blog, we will try to understand how “Search as you type” works and Quickly setup one demo using some sample data. You must have seen various websites like eCommerce, food apps, etc. where you just start typing & simultaneously relevant options start displaying as suggestions and autocomplete. We will try to achieve somewhat the same feature. Search as you type Elasticsearch gives this specific mapping type which you can simply set to a specific field where you want to perform this kind of search."><meta property="og:type" content="article"><meta property="og:url" content="https://ashish.one/blogs/search-as-you-type/"><meta property="og:image" content="https://ashish.one/img/misc/search_as_you_type.gif"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2022-03-18T01:24:55+05:30"><meta property="article:modified_time" content="2022-05-11T13:39:05+05:30"><meta property="og:site_name" content="ashish.one"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ashish.one/img/misc/search_as_you_type.gif"><meta name=twitter:title content="[Part -1] Search as you type"><meta name=twitter:description content="Introduction In this blog, we will try to understand how “Search as you type” works and Quickly setup one demo using some sample data. You must have seen various websites like eCommerce, food apps, etc. where you just start typing & simultaneously relevant options start displaying as suggestions and autocomplete. We will try to achieve somewhat the same feature. Search as you type Elasticsearch gives this specific mapping type which you can simply set to a specific field where you want to perform this kind of search."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://ashish.one/blogs/"},{"@type":"ListItem","position":2,"name":"[Part -1] Search as you type","item":"https://ashish.one/blogs/search-as-you-type/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Part -1] Search as you type","name":"[Part -1] Search as you type","description":"Introduction In this blog, we will try to understand how “Search as you type” works and Quickly setup one demo using some sample data. You must have seen various websites like eCommerce, food apps, etc. where you just start typing \u0026amp; simultaneously relevant options start displaying as suggestions and autocomplete. We will try to achieve somewhat the same feature. Search as you type Elasticsearch gives this specific mapping type which you can simply set to a specific field where you want to perform this kind of search.","keywords":["elasticsearch","search_as_you_type","Elastic"],"articleBody":"Introduction In this blog, we will try to understand how “Search as you type” works and Quickly setup one demo using some sample data. You must have seen various websites like eCommerce, food apps, etc. where you just start typing \u0026 simultaneously relevant options start displaying as suggestions and autocomplete. We will try to achieve somewhat the same feature. Search as you type Elasticsearch gives this specific mapping type which you can simply set to a specific field where you want to perform this kind of search.\nWhy search_as_you_type? No need to think about what kind of functionality like analyzer, tokenizer, etc. you have to apply to achieve this. It automatically handles everything in the backend by producing necessary terms on which you can query efficiently.\nYou can simply create mapping like the below example:\nCreate Index PUT products { \"mappings\": { \"properties\": { \"description\": { \"type\": \"search_as_you_type\" } } } } Insert sample data POST products/_doc/ { \"description\": \"best jogging shoes for men\" } How is data indexed ? search_as_you_type mapping creates 4 types of fields in the backend.\nField 1: description It will produce the terms according to the default analyzer if no analyzer is defined i.e. standard analyzer.\n[ \"best\", \"jogging\", \"shoes\", \"for\", \"men\" ] Field 2: description._2gram This will use a shingle token filter and produce the terms with shingle size 2. This means a shingle token filter produces the token by concatenating the adjacent token. You can find more here.\nThis operation will perform on all the terms which are created on the description field and it will produce the below terms.\n[ \"best jogging\", \"jogging shoes\", \"shoes for\", \"for men\" ] Field 3: description._3gram This will also use a shingle token filter and produce the terms with shingle size 3. This means it will concatenate 3 adjacent tokens like below.\n[ \"best jogging shoes\", \"jogging shoes for\", \"shoes for men\" ] Field 4: description._index_prefix This will apply an edge n gram token filter on the field description._3gram which means it will split terms (words) of description._3gram to a small substring that will start from the edge. You can have a look at the terms below.\n[ \"b\", \"be\", \"bes\", \"best\", \"best \", \"best j\", \"best jo\", \"best jog\", \"best jogg\", \"best joggi\", \"best joggin\", \"best jogging\", \"best jogging \", \"best jogging s\", \"best jogging sh\", \"best jogging sho\", \"best jogging shoe\", \"best jogging shoes\", \"j\", \"jo\", \"jog\", \"jogg\", \"joggi\", \"joggin\", \"jogging\", \"jogging \", \"jogging s\", \"jogging sh\", \"jogging sho\", \"jogging shoe\", \"jogging shoes\", \"jogging shoes \", \"jogging shoes f\", \"jogging shoes fo\", \"jogging shoes for\", \"s\", \"sh\", \"sho\", \"shoe\", \"shoes\", \"shoes \", \"shoes f\", \"shoes fo\", \"shoes for\", \"shoes for \", \"shoes for m\", \"shoes for me\", \"shoes for men\", \"f\", \"fo\", \"for\", \"for \", \"for m\", \"for me\", \"for men\", \"for men \", \"m\", \"me\", \"men\", \"men \", \"men \" ] As you noticed the token limit is up to 3 words only because description._3gram has generated 3 word tokens only.\nSearch Query multi_match We will use a multi_match query here. Because we want to look up on each subfield for a perfect match.\nGET products/_search { \"query\": { \"multi_match\": { \"query\": \"jogging\", \"fields\": [ \"description\", \"description._2gram\", \"description._3gram\" ] } } } The above query is going to search the term \"jogging\" on all 3 subfields which are specified in fields[].\n{ \"took\" : 2, \"timed_out\" : false, \"_shards\" : { \"total\" : 1, \"successful\" : 1, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 1, \"relation\" : \"eq\" }, \"max_score\" : 0.2876821, \"hits\" : [ { \"_index\" : \"products\", \"_id\" : \"TSNNiX8BYh0NLleBiu4u\", \"_score\" : 0.2876821, \"_source\" : { \"description\" : \"best jogging shoes for men\" } } ] } } Lets try with any substring (jog).\nGET products/_search { \"query\": { \"multi_match\": { \"query\": \"jog\", \"fields\": [ \"description\", \"description._2gram\", \"description._3gram\" ] } } } { \"took\" : 0, \"timed_out\" : false, \"_shards\" : { \"total\" : 1, \"successful\" : 1, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 0, \"relation\" : \"eq\" }, \"max_score\" : null, \"hits\" : [ ] } } The result is empty. Because there is no term created with the name jog if you closely look at the above generated tokens on respective fields.\nTo solve this we need to use the bool_prefix query.\nbool_prefix analyze the input and constructs the bool query from the terms. But it puts the last term in the prefix query. For example, input is given as men jogging s, So it will produce terms like [\"men\",\"jogging\",\"s\"] but it will always perform a prefix query on the last term which is \"s\". So documents will return where terms will match with \"men\" or \"jogging\" or any term which is starting with \"s\".\nBelow is the query which will give you the desired output.\nGET products/_search { \"query\": { \"multi_match\": { \"query\": \"jog\", \"type\": \"bool_prefix\", \"fields\": [ \"description\", \"description._2gram\", \"description._3gram\" ] } } } { \"took\" : 4, \"timed_out\" : false, \"_shards\" : { \"total\" : 1, \"successful\" : 1, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 1, \"relation\" : \"eq\" }, \"max_score\" : 1.0, \"hits\" : [ { \"_index\" : \"products\", \"_id\" : \"TSNNiX8BYh0NLleBiu4u\", \"_score\" : 1.0, \"_source\" : { \"description\" : \"best jogging shoes for men\" } } ] } } Here when we make a prefix query on the root field (description) or any subfields, It will rewrite the query as a term query on description._index_prefix field.\nThis matches more efficiently because prefixes up to 3 words are already created as the terms as shown in the above.\nNote: This query will search for terms irrespective of order. For example, if we search for jogging men, This will also give the result because it will search for both the terms jogging or men. In most of the cases this query (multi_match + bool_prefix) is recommended because the end user can search for any string like shoes or shoes for men or jogging shoes etc.\nWhat if you want to search with strict prefix order? You can use match_phrase_prefix, It will strictly match input from prefix in the same order only. So input like “men best” won’t return anything. Whereas you will get results with the previous one.\nGET products/_search { \"query\": { \"match_phrase_prefix\": { \"description\": \"best jogging s\" } } } It will return documents where the term’s prefix will be matched with “best jogging s”. Sometimes it can provide confusing results. You can check more about match_phrase_prefix.\nDemo Let’s take a practical experience of how it is going to work.\nSearch As You Type (Elasticsearch) Demo code and sample employees data to implement the “Search as you type” feature on elasticsearch.\nWritten the middleware API in python using flask. Used JQuery for javascript operations.\nInstallation Assuming you have successfully installed Elasticsearch and Kibana on your machine and it is working perfectly. Kindly refer respective installation document.\nOR\nYou can run Elasticsearch on the cloud with a few clicks.\nInstall Python3 \u0026 pip3 Refer Document to install python3 \u0026 pip3 on your system. Install flask pip3 install flask Install elasticsearch package pip3 install elasticsearch git Clone git clone https://github.com/ashishtiwari1993/search_as_you_type.git cd search_as_you_type Create Index and load data Make sure Elasticsearch and kibana are up and running fine on your machine.\nCreate Index PUT /sayt?pretty { \"mappings\": { \"properties\": { \"first_name\": { \"type\": \"search_as_you_type\" }, \"last_name\": { \"type\": \"search_as_you_type\" }, \"street_address\": { \"type\": \"search_as_you_type\" }, \"company\": { \"type\": \"search_as_you_type\" }, \"email\": { \"type\": \"search_as_you_type\" } } } } Load sample data Sample data.json file is given which need to load with the help of bulk API.\ncurl -s -H \"Content-Type: application/x-ndjson\" -XPOST \"localhost:9200/_bulk\" --data-binary \"@data.json\" Do not forget to change the elasticsearch’s endpoint.\nRun api.py \u0026 test Open api.py and change elasticsearch endpoint accordingly.\nes = Elasticsearch(\"http://localhost:9200\") Start API Server python3 api.py This will start the API service on port 5001.\nOpen index.html on your browser.\n","wordCount":"1335","inLanguage":"en","image":"https://ashish.one/img/misc/search_as_you_type.gif","datePublished":"2022-03-18T01:24:55+05:30","dateModified":"2022-05-11T13:39:05+05:30","author":{"@type":"Person","name":"Ashish Tiwari"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ashish.one/blogs/search-as-you-type/"},"publisher":{"@type":"Organization","name":"ashish.one","logo":{"@type":"ImageObject","url":"https://ashish.one/favicon.png"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ashish.one/ accesskey=h title="Ashish Tiwari (Alt + H)">Ashish Tiwari</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ashish.one/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://ashish.one/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://ashish.one/talks/ title=Talks><span>Talks</span></a></li><li><a href=https://ashish.one/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ashish.one/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ashish.one/>Home</a>&nbsp;»&nbsp;<a href=https://ashish.one/blogs/>Blogs</a></div><h1 class=post-title>[Part -1] Search as you type</h1><div class=post-meta><span title='2022-03-18 01:24:55 +0530 IST'>March 18, 2022</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Ashish Tiwari&nbsp;|&nbsp;<a href=https://github.com/ashishtiwari1993/ashish.one/tree/master/content/blogs/search_as_you_type.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=lazy src=https://ashish.one/img/misc/search_as_you_type.gif alt="Searcy As You Type"></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#why-search_as_you_type aria-label="Why search_as_you_type?">Why <code>search_as_you_type</code>?</a><ul><li><a href=#create-index aria-label="Create Index">Create Index</a></li><li><a href=#insert-sample-data aria-label="Insert sample data">Insert sample data</a></li><li><a href=#how-is-data-indexed- aria-label="How is data indexed ?">How is data indexed ?</a><ul><li><a href=#field-1-description aria-label="Field 1: description">Field 1: <code>description</code></a></li><li><a href=#field-2-description_2gram aria-label="Field 2: description._2gram">Field 2: <code>description._2gram</code></a></li><li><a href=#field-3-description_3gram aria-label="Field 3: description._3gram">Field 3: <code>description._3gram</code></a></li><li><a href=#field-4-description_index_prefix aria-label="Field 4: description._index_prefix">Field 4: <code>description._index_prefix</code></a></li></ul></li></ul></li><li><a href=#search-query aria-label="Search Query">Search Query</a><ul><li><a href=#multi_match aria-label=multi_match><code>multi_match</code></a></li><li><a href=#what-if-you-want-to-search-with-strict-prefix-order aria-label="What if you want to search with strict prefix order?">What if you want to search with strict prefix order?</a></li></ul></li><li><a href=#demo aria-label=Demo>Demo</a></li><li><a href=#search-as-you-type-elasticsearch aria-label="Search As You Type (Elasticsearch)">Search As You Type (Elasticsearch)</a><ul><li><a href=#installation aria-label=Installation>Installation</a><ul><li><a href=#install-python3--pip3 aria-label="Install Python3 &amp;amp; pip3">Install Python3 & pip3</a></li><li><a href=#git-clone aria-label="git Clone">git Clone</a></li><li><a href=#create-index-and-load-data aria-label="Create Index and load data">Create Index and load data</a><ul><li><a href=#create-index-1 aria-label="Create Index">Create Index</a></li><li><a href=#load-sample-data aria-label="Load sample data">Load sample data</a></li></ul></li><li><a href=#run-apipy--test aria-label="Run api.py &amp;amp; test">Run <code>api.py</code> & test</a><ul><li><a href=#start-api-server aria-label="Start API Server">Start API Server</a></li></ul></li></ul></li></ul></li></ul></div></details></div><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>In this blog, we will try to understand how “Search as you type” works and Quickly setup one demo using some sample data.
You must have seen various websites like eCommerce, food apps, etc. where you just start typing & simultaneously relevant options start displaying as suggestions and autocomplete. We will try to achieve somewhat the same feature.
Search as you type
Elasticsearch gives this specific mapping type which you can simply set to a specific field where you want to perform this kind of search.</p><h1 id=why-search_as_you_type>Why <code>search_as_you_type</code>?<a hidden class=anchor aria-hidden=true href=#why-search_as_you_type>#</a></h1><p>No need to think about what kind of functionality like analyzer, tokenizer, etc. you have to apply to achieve this. It automatically handles everything in the backend by producing necessary terms on which you can query efficiently.</p><p>You can simply create mapping like the below example:</p><h2 id=create-index>Create Index<a hidden class=anchor aria-hidden=true href=#create-index>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>PUT products
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;mappings&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;properties&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;description&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;search_as_you_type&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=insert-sample-data>Insert sample data<a hidden class=anchor aria-hidden=true href=#insert-sample-data>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>POST products/_doc/
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;best jogging shoes for men&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=how-is-data-indexed->How is data indexed ?<a hidden class=anchor aria-hidden=true href=#how-is-data-indexed->#</a></h2><p><code>search_as_you_type</code> mapping creates 4 types of fields in the backend.</p><h3 id=field-1-description>Field 1: <code>description</code><a hidden class=anchor aria-hidden=true href=#field-1-description>#</a></h3><p>It will produce the terms according to the default analyzer if no analyzer is defined i.e. <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-standard-analyzer.html>standard analyzer</a>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shoes&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;for&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;men&#34;</span>
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><h3 id=field-2-description_2gram>Field 2: <code>description._2gram</code><a hidden class=anchor aria-hidden=true href=#field-2-description_2gram>#</a></h3><p>This will use a <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-shingle-tokenfilter.html>shingle token filter</a> and produce the terms with shingle size 2.
This means a shingle token filter produces the token by concatenating the adjacent token. You can find more <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-shingle-tokenfilter.html>here</a>.</p><p>This operation will perform on all the terms which are created on the <code>description</code> field and it will produce the below terms.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[ 
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best jogging&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging shoes&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shoes for&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;for men&#34;</span>
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><h3 id=field-3-description_3gram>Field 3: <code>description._3gram</code><a hidden class=anchor aria-hidden=true href=#field-3-description_3gram>#</a></h3><p>This will also use a shingle token filter and produce the terms with shingle size 3. This means it will concatenate 3 adjacent tokens like below.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best jogging shoes&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging shoes for&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shoes for men&#34;</span>
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><h3 id=field-4-description_index_prefix>Field 4: <code>description._index_prefix</code><a hidden class=anchor aria-hidden=true href=#field-4-description_index_prefix>#</a></h3><p>This will apply an <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-edgengram-tokenizer.html>edge n gram token filter</a> on the field <code>description._3gram</code> which means it will split terms (words) of <code>description._3gram</code> to a small substring that will start from the edge.
You can have a look at the terms below.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;b&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;be&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;bes&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best &#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best j&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best jo&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best jog&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best jogg&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best joggi&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best joggin&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best jogging&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best jogging &#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best jogging s&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best jogging sh&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best jogging sho&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best jogging shoe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;best jogging shoes&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;j&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jo&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jog&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogg&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;joggi&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;joggin&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging &#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging s&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging sh&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging sho&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging shoe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging shoes&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging shoes &#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging shoes f&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging shoes fo&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;jogging shoes for&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;s&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;sh&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;sho&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shoe&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shoes&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shoes &#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shoes f&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shoes fo&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shoes for&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shoes for &#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shoes for m&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shoes for me&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;shoes for men&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;f&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;fo&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;for&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;for &#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;for m&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;for me&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;for men&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;for men &#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;m&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;me&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;men&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;men &#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;men  &#34;</span>
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>As you noticed the token limit is up to 3 words only because <code>description._3gram</code> has generated 3 word tokens only.</p><h1 id=search-query>Search Query<a hidden class=anchor aria-hidden=true href=#search-query>#</a></h1><h2 id=multi_match><code>multi_match</code><a hidden class=anchor aria-hidden=true href=#multi_match>#</a></h2><p>We will use a <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html>multi_match</a> query here. Because we want to look up on each subfield for a perfect match.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>GET products/_search
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;query&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;multi_match&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;query&#34;</span>: <span style=color:#e6db74>&#34;jogging&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;fields&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;description&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;description._2gram&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;description._3gram&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>The above query is going to search the term <code>"jogging"</code> on all 3 subfields which are specified in <code>fields[]</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;took&#34;</span> : <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;timed_out&#34;</span> : <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;_shards&#34;</span> : {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;total&#34;</span> : <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;successful&#34;</span> : <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;skipped&#34;</span> : <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;failed&#34;</span> : <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;hits&#34;</span> : {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;total&#34;</span> : {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;value&#34;</span> : <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;relation&#34;</span> : <span style=color:#e6db74>&#34;eq&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;max_score&#34;</span> : <span style=color:#ae81ff>0.2876821</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;hits&#34;</span> : [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_index&#34;</span> : <span style=color:#e6db74>&#34;products&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_id&#34;</span> : <span style=color:#e6db74>&#34;TSNNiX8BYh0NLleBiu4u&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_score&#34;</span> : <span style=color:#ae81ff>0.2876821</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_source&#34;</span> : {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;description&#34;</span> : <span style=color:#e6db74>&#34;best jogging shoes for men&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Lets try with any substring (<code>jog</code>).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>GET products/_search
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;query&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;multi_match&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;query&#34;</span>: <span style=color:#e6db74>&#34;jog&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;fields&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;description&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;description._2gram&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;description._3gram&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;took&#34;</span> : <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;timed_out&#34;</span> : <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;_shards&#34;</span> : {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;total&#34;</span> : <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;successful&#34;</span> : <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;skipped&#34;</span> : <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;failed&#34;</span> : <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;hits&#34;</span> : {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;total&#34;</span> : {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;value&#34;</span> : <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;relation&#34;</span> : <span style=color:#e6db74>&#34;eq&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;max_score&#34;</span> : <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;hits&#34;</span> : [ ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The result is empty. Because there is no term created with the name <strong><code>jog</code></strong> if you closely look at the above generated tokens on respective fields.</p><p>To solve this we need to use the <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-bool-prefix-query.html>bool_prefix</a> query.</p><p><code>bool_prefix</code> analyze the input and constructs the bool query from the terms. But it puts the last term in the prefix query. For example, input is given as <code>men jogging s</code>, So it will produce terms like <code>["men","jogging","s"]</code> but it will always perform a prefix query on the last term which is <code>"s"</code>. So documents will return where terms will match with <code>"men"</code> or <code>"jogging"</code> or any term which is starting with <code>"s"</code>.</p><p>Below is the query which will give you the desired output.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>GET products/_search
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;query&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;multi_match&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;query&#34;</span>: <span style=color:#e6db74>&#34;jog&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;bool_prefix&#34;</span>, 
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;fields&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;description&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;description._2gram&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;description._3gram&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;took&#34;</span> : <span style=color:#ae81ff>4</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;timed_out&#34;</span> : <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;_shards&#34;</span> : {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;total&#34;</span> : <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;successful&#34;</span> : <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;skipped&#34;</span> : <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;failed&#34;</span> : <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;hits&#34;</span> : {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;total&#34;</span> : {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;value&#34;</span> : <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;relation&#34;</span> : <span style=color:#e6db74>&#34;eq&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;max_score&#34;</span> : <span style=color:#ae81ff>1.0</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;hits&#34;</span> : [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_index&#34;</span> : <span style=color:#e6db74>&#34;products&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_id&#34;</span> : <span style=color:#e6db74>&#34;TSNNiX8BYh0NLleBiu4u&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_score&#34;</span> : <span style=color:#ae81ff>1.0</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_source&#34;</span> : {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;description&#34;</span> : <span style=color:#e6db74>&#34;best jogging shoes for men&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here when we make a prefix query on the root field (<code>description</code>) or any subfields, It will rewrite the query as a <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html>term</a> query on <code>description._index_prefix</code> field.</p><p>This matches more efficiently because prefixes up to 3 words are already created as the terms as shown in the above.</p><blockquote><p>Note: This query will search for terms irrespective of order. For example, if we search for <code>jogging men</code>, This will also give the result because it will search for both the terms <code>jogging</code> or <code>men</code>. In most of the cases this query (multi_match + bool_prefix) is recommended because the end user can search for any string like <code>shoes</code> or <code>shoes for men</code> or <code>jogging shoes</code> etc.</p></blockquote><h2 id=what-if-you-want-to-search-with-strict-prefix-order>What if you want to search with strict prefix order?<a hidden class=anchor aria-hidden=true href=#what-if-you-want-to-search-with-strict-prefix-order>#</a></h2><p>You can use <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase-prefix.html>match_phrase_prefix</a>, It will strictly match input from prefix in the same order only. So input like “men best” won’t return anything. Whereas you will get results with the previous one.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>GET products/_search
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;query&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;match_phrase_prefix&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;best jogging s&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>It will return documents where the term&rsquo;s prefix will be matched with “best jogging s”. Sometimes it can provide confusing results. You can check more about <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase-prefix.html#match-phrase-prefix-autocomplete>match_phrase_prefix</a>.</p><h1 id=demo>Demo<a hidden class=anchor aria-hidden=true href=#demo>#</a></h1><p>Let’s take a practical experience of how it is going to work.</p><h1 id=search-as-you-type-elasticsearch>Search As You Type (Elasticsearch)<a hidden class=anchor aria-hidden=true href=#search-as-you-type-elasticsearch>#</a></h1><p>Demo code and sample employees data to implement the &ldquo;Search as you type&rdquo; feature on elasticsearch.</p><p>Written the middleware API in <code>python</code> using <a href=https://flask.palletsprojects.com/en/2.0.x/>flask</a>. Used <a href=https://jquery.com/>JQuery</a> for javascript operations.</p><h2 id=installation>Installation<a hidden class=anchor aria-hidden=true href=#installation>#</a></h2><p>Assuming you have successfully installed <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html>Elasticsearch</a> and <a href=https://www.elastic.co/guide/en/kibana/current/install.html>Kibana</a> on your machine and it is working perfectly. Kindly refer respective installation document.</p><p>OR</p><p>You can run <a href=https://cloud.elastic.co/registration>Elasticsearch on the cloud</a> with a few clicks.</p><h3 id=install-python3--pip3>Install Python3 & pip3<a hidden class=anchor aria-hidden=true href=#install-python3--pip3>#</a></h3><ol><li>Refer <a href=https://www.python.org/downloads/>Document</a> to install <code>python3</code> & <code>pip3</code> on your system.</li><li>Install <code>flask</code></li></ol><pre tabindex=0><code>pip3 install flask
</code></pre><ol start=3><li>Install <code>elasticsearch</code> package</li></ol><pre tabindex=0><code>pip3 install elasticsearch
</code></pre><h3 id=git-clone>git Clone<a hidden class=anchor aria-hidden=true href=#git-clone>#</a></h3><pre tabindex=0><code>git clone https://github.com/ashishtiwari1993/search_as_you_type.git
cd search_as_you_type
</code></pre><h3 id=create-index-and-load-data>Create Index and load data<a hidden class=anchor aria-hidden=true href=#create-index-and-load-data>#</a></h3><p>Make sure Elasticsearch and kibana are up and running fine on your machine.</p><h4 id=create-index-1>Create Index<a hidden class=anchor aria-hidden=true href=#create-index-1>#</a></h4><pre tabindex=0><code>PUT /sayt?pretty
{
  &#34;mappings&#34;: {
    &#34;properties&#34;: {
      &#34;first_name&#34;: {
        &#34;type&#34;: &#34;search_as_you_type&#34;
      },
      &#34;last_name&#34;: {
        &#34;type&#34;: &#34;search_as_you_type&#34;
      },
      &#34;street_address&#34;: {
        &#34;type&#34;: &#34;search_as_you_type&#34;
      },
      &#34;company&#34;: {
        &#34;type&#34;: &#34;search_as_you_type&#34;
      },
      &#34;email&#34;: {
        &#34;type&#34;: &#34;search_as_you_type&#34;
      }
    }
  }
}
</code></pre><h4 id=load-sample-data>Load sample data<a hidden class=anchor aria-hidden=true href=#load-sample-data>#</a></h4><p>Sample <a href=https://github.com/ashishtiwari1993/search_as_you_type/blob/main/data.json>data.json</a> file is given which need to load with the help of <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-bulk.html>bulk API</a>.</p><pre tabindex=0><code>curl -s -H &#34;Content-Type: application/x-ndjson&#34; -XPOST &#34;localhost:9200/_bulk&#34; --data-binary &#34;@data.json&#34;
</code></pre><p>Do not forget to change the elasticsearch&rsquo;s endpoint.</p><h3 id=run-apipy--test>Run <code>api.py</code> & test<a hidden class=anchor aria-hidden=true href=#run-apipy--test>#</a></h3><p>Open <code>api.py</code> and change elasticsearch endpoint accordingly.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>es <span style=color:#f92672>=</span> Elasticsearch(<span style=color:#e6db74>&#34;http://localhost:9200&#34;</span>)
</span></span></code></pre></div><h4 id=start-api-server>Start API Server<a hidden class=anchor aria-hidden=true href=#start-api-server>#</a></h4><pre tabindex=0><code>python3 api.py
</code></pre><p>This will start the API service on port <code>5001</code>.</p><p>Open <code>index.html</code> on your browser.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ashish.one/tags/elasticsearch/>elasticsearch</a></li><li><a href=https://ashish.one/tags/search_as_you_type/>search_as_you_type</a></li><li><a href=https://ashish.one/tags/elastic/>Elastic</a></li></ul><nav class=paginav><a class=prev href=https://ashish.one/blogs/parsing-custom-log-format-to-the-elasticsearch/><span class=title>« Prev</span><br><span>Parsing Custom log format to the Elasticsearch</span></a>
<a class=next href=https://ashish.one/talks/devops-conf-2022/><span class=title>Next »</span><br><span>Parse custom logs in Elasticsearch using grok_pattern</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share [Part -1] Search as you type on twitter" href="https://twitter.com/intent/tweet/?text=%5bPart%20-1%5d%20Search%20as%20you%20type&url=https%3a%2f%2fashish.one%2fblogs%2fsearch-as-you-type%2f&hashtags=elasticsearch%2csearch_as_you_type%2cElastic"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [Part -1] Search as you type on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fashish.one%2fblogs%2fsearch-as-you-type%2f&title=%5bPart%20-1%5d%20Search%20as%20you%20type&summary=%5bPart%20-1%5d%20Search%20as%20you%20type&source=https%3a%2f%2fashish.one%2fblogs%2fsearch-as-you-type%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [Part -1] Search as you type on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fashish.one%2fblogs%2fsearch-as-you-type%2f&title=%5bPart%20-1%5d%20Search%20as%20you%20type"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [Part -1] Search as you type on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fashish.one%2fblogs%2fsearch-as-you-type%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [Part -1] Search as you type on whatsapp" href="https://api.whatsapp.com/send?text=%5bPart%20-1%5d%20Search%20as%20you%20type%20-%20https%3a%2f%2fashish.one%2fblogs%2fsearch-as-you-type%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share [Part -1] Search as you type on telegram" href="https://telegram.me/share/url?text=%5bPart%20-1%5d%20Search%20as%20you%20type&url=https%3a%2f%2fashish.one%2fblogs%2fsearch-as-you-type%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><script src=https://giscus.app/client.js data-repo=ashishtiwari1993/ashish.one data-repo-id="MDEwOlJlcG9zaXRvcnkyMTAxMjkzNjY=" data-category=General data-category-id=DIC_kwDODIZR1s4CP1P2 data-mapping=title data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=dark_high_contrast data-lang=en crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://ashish.one/>ashish.one</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>