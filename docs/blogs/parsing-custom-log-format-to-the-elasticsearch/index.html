<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Parsing Custom log format to the Elasticsearch | ashish.one</title><meta name=keywords content="elasticsearch,grok-processor,grok-pattern,ingest-pipeline,Elastic"><meta name=description content="Introduction As a developer, you need to log everything it may be info, error or debug logs, etc. There are multiple types of log formats like Common log, JSON log, etc. and there are already solutions available in an elastic stack like filebeat to read JSON logs and push them to elasticsearch.
There can be cases where you need to log the data according to your convenience which will not be any standard log format."><meta name=author content="Ashish Tiwari"><link rel=canonical href=https://ashish.one/blogs/parsing-custom-log-format-to-the-elasticsearch/><link crossorigin=anonymous href=https://ashish.one/assets/css/stylesheet.ba7b1a0e212a12ce4d86f957158b1ebf0c5d1a6c7ad2b8d146953d5e6efa5beb.css integrity="sha256-unsaDiEqEs5NhvlXFYsevwxdGmx60rjRRpU9Xm76W+s=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=https://ashish.one/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://ashish.one/favicon.png><link rel=icon type=image/png sizes=16x16 href=https://ashish.one/favicon.png><link rel=icon type=image/png sizes=32x32 href=https://ashish.one/favicon.png><link rel=apple-touch-icon href=https://ashish.one/favicon.png><link rel=mask-icon href=https://ashish.one/favicon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-149424518-1","auto"),ga("send","pageview"))</script><meta property="og:title" content="Parsing Custom log format to the Elasticsearch"><meta property="og:description" content="Introduction As a developer, you need to log everything it may be info, error or debug logs, etc. There are multiple types of log formats like Common log, JSON log, etc. and there are already solutions available in an elastic stack like filebeat to read JSON logs and push them to elasticsearch.
There can be cases where you need to log the data according to your convenience which will not be any standard log format."><meta property="og:type" content="article"><meta property="og:url" content="https://ashish.one/blogs/parsing-custom-log-format-to-the-elasticsearch/"><meta property="og:image" content="https://ashish.one/img/misc/parse-custom-log.png"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2022-04-29T01:24:55+05:30"><meta property="article:modified_time" content="2022-05-11T13:39:05+05:30"><meta property="og:site_name" content="ashish.one"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ashish.one/img/misc/parse-custom-log.png"><meta name=twitter:title content="Parsing Custom log format to the Elasticsearch"><meta name=twitter:description content="Introduction As a developer, you need to log everything it may be info, error or debug logs, etc. There are multiple types of log formats like Common log, JSON log, etc. and there are already solutions available in an elastic stack like filebeat to read JSON logs and push them to elasticsearch.
There can be cases where you need to log the data according to your convenience which will not be any standard log format."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://ashish.one/blogs/"},{"@type":"ListItem","position":2,"name":"Parsing Custom log format to the Elasticsearch","item":"https://ashish.one/blogs/parsing-custom-log-format-to-the-elasticsearch/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Parsing Custom log format to the Elasticsearch","name":"Parsing Custom log format to the Elasticsearch","description":"Introduction As a developer, you need to log everything it may be info, error or debug logs, etc. There are multiple types of log formats like Common log, JSON log, etc. and there are already solutions available in an elastic stack like filebeat to read JSON logs and push them to elasticsearch.\nThere can be cases where you need to log the data according to your convenience which will not be any standard log format.","keywords":["elasticsearch","grok-processor","grok-pattern","ingest-pipeline","Elastic"],"articleBody":"Introduction As a developer, you need to log everything it may be info, error or debug logs, etc. There are multiple types of log formats like Common log, JSON log, etc. and there are already solutions available in an elastic stack like filebeat to read JSON logs and push them to elasticsearch.\nThere can be cases where you need to log the data according to your convenience which will not be any standard log format. Or sometimes you just need to dump the log in an unstructured way but you need to have it in a structured format if you want to analyze those.\nIn this article, we are going to see how we can parse custom logs of any format into Elasticsearch. Elasticsearch provides the ingest pipeline with grok processor which will be able to match any unstructured log.\nOverview Ingest Pipeline Elasticsearch gives ingest pipeline where it let you perform different types of operations or data transformations before indexing the data. The pipeline consists of a series of various processors.\nEach processor in the pipeline takes input and produces the output. That output goes as input to the next processor.\nLike below, After converting into lowercase letters by “lowercase processor” it sends the same string as input to the “split processor”.\nExample\n{\"date\":\"HELLO - WORLD\"} Input → | lowercase processor ({\"date\":\"hello - world\"}) → split processor ({\"date\":\"hello world\"}) | → Index You can check more about ingest pipeline and processors.\nGrok Processor Grok Processor allows you to extract structured data from the ingested value on the specific field. Grok Processor works with grok patterns.\nLet’s suppose you have the following document\n{ \"Ip\":\"1.2.3.4\", \"country\":\"India\", \"log\":\"LEVEL:ERROR,method:fetchUser(),message:user not found\" } You can mention the field name (Ex. log) where you want to apply a grok processor. The Grok processor uses the Grok pattern.\nGrok pattern Grok pattern is the regular expression which is the alias of some of the predefined expressions which can be reused.\nBelow is some sample grok patterns:\nHOSTNAME \\b(?:[0-9A-Za-z][0-9A-Za-z-]{0,62})(?:\\.(?:[0-9A-Za-z][0-9A-Za-z-]{0,62}))*(\\.?|\\b) USERNAME [a-zA-Z0-9._-]+ USER %{USERNAME} SPACE \\s* Here HOSTNAME, USERNAME, USER \u0026 SPACE are Grok pattern names.\nI can directly use SPACE label to define regex for space instead of a regular pattern like \\s*. Also, the Grok pattern can be reused as the same as USERNAME.\nPattern list You can find all pattern list on the below link:\nhttps://github.com/elastic/elasticsearch/tree/8.1/libs/grok/src/main/resources/patterns\nYou can select any folder and explore all the patterns.\nGrok pattern: https://github.com/elastic/elasticsearch/blob/master/libs/grok/src/main/resources/patterns/ecs-v1/grok-patterns\nThe flow Create \u0026 Test Ingest Pipeline Index custom data Lets create the pipeline with a grok processor which is going to parse the message field with the document below.\n{ \"Ip\":\"1.2.3.4\", \"country\":\"India\", \"message\":\"LEVEL:ERROR,method:fetchUser(),message:user not found,code:123\" } I would like to extract the below data from message field and index into elasticsearch,\n\"method_name\" : \"fetchUser\", \"log_level\" : \"ERROR\", \"response_code\" : \"123\", \"message\" : \"user not found\" Create \u0026 Test Ingest Pipeline Syntax %{SYNTAX:ID} SYNTAX: It is the pattern name.\nID: It is the key name of the document.\nData need to parse\nLEVEL:ERROR,method:fetchUser(),message:user not found Let’s match some of the grok patterns from the below file https://github.com/elastic/elasticsearch/blob/master/libs/grok/src/main/resources/patterns/ecs-v1/grok-patterns\nERROR = %{LOGLEVEL:log_level} fetchUser = %{WORD:method_name} user not found = %{GREEDYDATA:message} 123 = code:(?(?:[+-]?(?:[0-9]+))) Data\nLEVEL:ERROR,method:fetchUser(),message:user not found Final Pattern\n\"LEVEL:%{LOGLEVEL:log_level},method:%{WORD:method_name}\\\\(\\\\),message:%{GREEDYDATA:message},code:(?(?:[+-]?(?:[0-9]+)))\" Note: You can add your own regex as well. For example, I have added regex for code.\nTest pipeline For testing above pattern or pipeline we can use Simulate Pipeline API like below:\n_simulate POST /_ingest/pipeline/_simulate?pretty { \"pipeline\": { \"description\" : \"testing grok processor\", \"processors\": [ { \"grok\": { \"field\": \"log\", \"patterns\": [\"LEVEL:%{LOGLEVEL:log_level},method:%{WORD:method_name}\\\\(\\\\),message:%{GREEDYDATA:message},code:(?(?:[+-]?(?:[0-9]+)))\"] } } ] }, \"docs\":[ { \"_source\": { \"log\": \"LEVEL:ERROR,method:fetchUser(),message:user not found,code:123\" } } ] } Response { \"docs\" : [ { \"doc\" : { \"_index\" : \"_index\", \"_id\" : \"_id\", \"_source\" : { \"response_code\" : \"123\", \"log\" : \"LEVEL:ERROR,method:fetchUser(),message:user not found,code:123\", \"method_name\" : \"fetchUser\", \"log_level\" : \"ERROR\", \"message\" : \"user not found\" }, \"_ingest\" : { \"timestamp\" : \"2022-04-29T14:20:59.454111422Z\" } } } ] } As you can see we got the desired output. Now let’s save the pipeline.\nSave pipeline Pipeline can be saved using _ingest/pipeline API.\nPUT /_ingest/pipeline/custom_log?pretty { \"description\" : \"testing grok processor\", \"processors\": [ { \"grok\": { \"field\": \"log\", \"patterns\": [\"LEVEL:%{LOGLEVEL:log_level},method:%{WORD:method_name}\\\\(\\\\),message:%{GREEDYDATA:message},code:(?(?:[+-]?(?:[0-9]+)))\"] } } ] } Custom_log: It is the pipeline name. We need to specify the pipeline name while indexing the data.\nIndex custom data Now let’s index some data with the same pipeline which we created.\nPOST data-stream/_doc?pipeline=custom_log { \"log\" : \"LEVEL:INFO,method:addUser(),message:user added successfully.,code:200\" } POST data-stream/_doc?pipeline=custom_log { \"log\" : \"LEVEL:DEBUG,method:deleteUser(),message:user_id notfound.,code:433\" } POST data-stream/_doc?pipeline=custom_log { \"log\" : \"LEVEL:ERROR,method:fetchUser(),message:Database connection timeout,code:567\" } Check all data\nGET data-stream/_search?pretty { \"took\" : 898, \"timed_out\" : false, \"_shards\" : { \"total\" : 1, \"successful\" : 1, \"skipped\" : 0, \"failed\" : 0 }, \"hits\" : { \"total\" : { \"value\" : 3, \"relation\" : \"eq\" }, \"max_score\" : 1.0, \"hits\" : [ { \"_index\" : \"data-stream\", \"_id\" : \"3460dYABYeDE95hG23XJ\", \"_score\" : 1.0, \"_source\" : { \"response_code\" : \"200\", \"log\" : \"LEVEL:INFO,method:addUser(),message:user added successfully.,code:200\", \"method_name\" : \"addUser\", \"log_level\" : \"INFO\", \"message\" : \"user added successfully.\" } }, { \"_index\" : \"data-stream\", \"_id\" : \"Kwi2dYABbuPmoOiCSUjL\", \"_score\" : 1.0, \"_source\" : { \"response_code\" : \"433\", \"log\" : \"LEVEL:DEBUG,method:deleteUser(),message:user_id notfound.,code:433\", \"method_name\" : \"deleteUser\", \"log_level\" : \"DEBUG\", \"message\" : \"user_id notfound.\" } }, { \"_index\" : \"data-stream\", \"_id\" : \"LAi4dYABbuPmoOiCmUgb\", \"_score\" : 1.0, \"_source\" : { \"response_code\" : \"567\", \"log\" : \"LEVEL:ERROR,method:fetchUser(),message:Database connection timeout,code:567\", \"method_name\" : \"fetchUser\", \"log_level\" : \"ERROR\", \"message\" : \"Database connection timeout\" } } ] } } Parsing common log format Common log format is standard format for logging which is used by webservers and system log generators etc.\nLet’s say we having below log:\n97.92.139.153 1254 ashishtiwari [04/Mar/2022:15:18:55 +0530] \"GET /niches HTTP/1.1\" 201 2322 Grok Pattern Final Grok Pattern %{IPORHOST:ip} %{USER:user_id} %{USERNAME:username} \\\\[%{HTTPDATE:date}\\\\] \\\"%{WORD:request.method} %{URIPATH:request.path} %{URIPROTO:request.proto}/%{NUMBER:request.http_version}\\\" %{NUMBER:request.response} %{NUMBER:request.size_bytes} _simulate Lets simulate the pipeline with above grok pattern\nPOST /_ingest/pipeline/_simulate?pretty { \"pipeline\": { \"description\" : \"testing grok processor\", \"processors\": [ { \"grok\": { \"field\": \"log\", \"patterns\": [\"%{IPORHOST:ip} %{USER:user_id} %{USERNAME:username} \\\\[%{HTTPDATE:date}\\\\] \\\"%{WORD:request.method} %{URIPATH:request.path} %{URIPROTO:request.proto}/%{NUMBER:request.http_version}\\\" %{NUMBER:request.response} %{NUMBER:request.size_bytes}\"] } } ] }, \"docs\":[ { \"_source\": { \"log\": \"97.92.139.153 1254 ashishtiwari [04/Mar/2022:15:18:55 +0530] \\\"GET /niches HTTP/1.1\\\" 201 2322\" } } ] } Response { \"docs\" : [ { \"doc\" : { \"_index\" : \"_index\", \"_id\" : \"_id\", \"_source\" : { \"date\" : \"04/Mar/2022:15:18:55 +0530\", \"request\" : { \"path\" : \"/niches\", \"size_bytes\" : \"2322\", \"method\" : \"GET\", \"response\" : \"201\", \"proto\" : \"HTTP\", \"http_version\" : \"1.1\" }, \"log\" : \"\"\"97.92.139.153 1254 ashishtiwari [04/Mar/2022:15:18:55 +0530] \"GET /niches HTTP/1.1\" 201 2322\"\"\", \"user_id\" : \"1254\", \"ip\" : \"97.92.139.153\", \"username\" : \"ashishtiwari\" }, \"_ingest\" : { \"timestamp\" : \"2022-04-29T14:42:51.765427484Z\" } } } ] } As we can see it successfully parsed the data. You can save the pipeline and index the data as shown on the above steps.\nSimilarly you can parse any log format with Grok pattern.\nDemo You can also check the demo on the below link where I presented how you can parse common log format using ingest pipeline and grok processor.\nhttps://ashish.one/talks/devops-conf-2022/\nConclusion We have seen how we can parse any types of log format into elasticsearch with the help of ingest pipeline \u0026 grok processor. You can also use this ingest pipeline with filebeat or logstash. Where you just need to specify the pipeline name.\nFeel free to put in comments if you have any doubts.\n","wordCount":"1208","inLanguage":"en","image":"https://ashish.one/img/misc/parse-custom-log.png","datePublished":"2022-04-29T01:24:55+05:30","dateModified":"2022-05-11T13:39:05+05:30","author":{"@type":"Person","name":"Ashish Tiwari"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ashish.one/blogs/parsing-custom-log-format-to-the-elasticsearch/"},"publisher":{"@type":"Organization","name":"ashish.one","logo":{"@type":"ImageObject","url":"https://ashish.one/favicon.png"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ashish.one/ accesskey=h title="Ashish Tiwari (Alt + H)">Ashish Tiwari</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ashish.one/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://ashish.one/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://ashish.one/talks/ title=Talks><span>Talks</span></a></li><li><a href=https://ashish.one/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://ashish.one/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ashish.one/>Home</a>&nbsp;»&nbsp;<a href=https://ashish.one/blogs/>Blogs</a></div><h1 class=post-title>Parsing Custom log format to the Elasticsearch</h1><div class=post-meta><span title='2022-04-29 01:24:55 +0530 IST'>April 29, 2022</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Ashish Tiwari&nbsp;|&nbsp;<a href=https://github.com/ashishtiwari1993/ashish.one/tree/master/content/blogs/elastic-parse-custom-logs.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=lazy src=https://ashish.one/img/misc/parse-custom-log.png alt="Parsing Custom log format to the Elasticsearch"></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#overview aria-label=Overview>Overview</a><ul><li><a href=#ingest-pipeline aria-label="Ingest Pipeline">Ingest Pipeline</a></li><li><a href=#grok-processor aria-label="Grok Processor">Grok Processor</a></li><li><a href=#grok-pattern aria-label="Grok pattern">Grok pattern</a><ul><li><a href=#pattern-list aria-label="Pattern list">Pattern list</a></li></ul></li></ul></li><li><a href=#the-flow aria-label="The flow">The flow</a><ul><li><a href=#create--test-ingest-pipeline aria-label="Create &amp;amp; Test Ingest Pipeline">Create & Test Ingest Pipeline</a><ul><li><a href=#syntax aria-label=Syntax>Syntax</a></li></ul></li><li><a href=#test-pipeline aria-label="Test pipeline">Test pipeline</a><ul><ul><li><a href=#_simulate aria-label=_simulate>_simulate</a></li><li><a href=#response aria-label=Response>Response</a></li></ul><li><a href=#save-pipeline aria-label="Save pipeline">Save pipeline</a></li></ul></li><li><a href=#index-custom-data aria-label="Index custom data">Index custom data</a></li></ul></li><li><a href=#parsing-common-log-format aria-label="Parsing common log format">Parsing common log format</a><ul><li><a href=#grok-pattern-1 aria-label="Grok Pattern">Grok Pattern</a></li><li><a href=#final-grok-pattern aria-label="Final Grok Pattern">Final Grok Pattern</a></li><li><a href=#_simulate-1 aria-label=_simulate>_simulate</a></li><li><a href=#response-1 aria-label=Response>Response</a></li></ul></li><li><a href=#demo aria-label=Demo>Demo</a></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li></ul></div></details></div><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>#</a></h1><p>As a developer, you need to log everything it may be info, error or debug logs, etc. There are multiple types of log formats like Common log, JSON log, etc. and there are already solutions available in an elastic stack like filebeat to read JSON logs and push them to elasticsearch.</p><p>There can be cases where you need to log the data according to your convenience which will not be any standard log format. Or sometimes you just need to dump the log in an unstructured way but you need to have it in a structured format if you want to analyze those.</p><p>In this article, we are going to see how we can parse custom logs of any format into Elasticsearch. Elasticsearch provides the ingest pipeline with grok processor which will be able to match any unstructured log.</p><h1 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h1><h2 id=ingest-pipeline>Ingest Pipeline<a hidden class=anchor aria-hidden=true href=#ingest-pipeline>#</a></h2><p>Elasticsearch gives <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/ingest.html>ingest pipeline</a> where it let you perform different types of operations or data transformations before indexing the data. The pipeline consists of a series of various processors.</p><p>Each processor in the pipeline takes input and produces the output. That output goes as input to the next processor.</p><p>Like below, After converting into lowercase letters by &ldquo;lowercase processor&rdquo; it sends the same string as input to the &ldquo;split processor&rdquo;.</p><p>Example</p><pre tabindex=0><code>{&#34;date&#34;:&#34;HELLO - WORLD&#34;} Input → |  lowercase processor ({&#34;date&#34;:&#34;hello - world&#34;}) → split processor ({&#34;date&#34;:&#34;hello world&#34;})   |  → Index
</code></pre><p>You can check more about ingest <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/ingest.html>pipeline</a> and <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/processors.html>processors</a>.</p><h2 id=grok-processor>Grok Processor<a hidden class=anchor aria-hidden=true href=#grok-processor>#</a></h2><p><a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/grok-processor.html>Grok Processor</a> allows you to extract structured data from the ingested value on the specific field. Grok Processor works with grok patterns.</p><p>Let&rsquo;s suppose you have the following document</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Ip&#34;</span>:<span style=color:#e6db74>&#34;1.2.3.4&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;country&#34;</span>:<span style=color:#e6db74>&#34;India&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;log&#34;</span>:<span style=color:#e6db74>&#34;LEVEL:ERROR,method:fetchUser(),message:user not found&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You can mention the field name (Ex. <code>log</code>) where you want to apply a grok processor. The Grok processor uses the Grok pattern.</p><h2 id=grok-pattern>Grok pattern<a hidden class=anchor aria-hidden=true href=#grok-pattern>#</a></h2><p>Grok pattern is the regular expression which is the alias of some of the predefined expressions which can be reused.</p><p>Below is some sample grok patterns:</p><pre tabindex=0><code>HOSTNAME \b(?:[0-9A-Za-z][0-9A-Za-z-]{0,62})(?:\.(?:[0-9A-Za-z][0-9A-Za-z-]{0,62}))*(\.?|\b)
USERNAME [a-zA-Z0-9._-]+
USER %{USERNAME}
SPACE \s*
</code></pre><p>Here <code>HOSTNAME</code>, <code>USERNAME</code>, <code>USER</code> & <code>SPACE</code> are Grok pattern names.</p><p>I can directly use <code>SPACE</code> label to define regex for space instead of a regular pattern like <code>\s*</code>. Also, the Grok pattern can be reused as the same as <code>USERNAME</code>.</p><h3 id=pattern-list>Pattern list<a hidden class=anchor aria-hidden=true href=#pattern-list>#</a></h3><p>You can find all pattern list on the below link:</p><p><a href=https://github.com/elastic/elasticsearch/tree/8.1/libs/grok/src/main/resources/patterns>https://github.com/elastic/elasticsearch/tree/8.1/libs/grok/src/main/resources/patterns</a></p><p>You can select any folder and explore all the patterns.</p><p><strong>Grok pattern</strong>: <a href=https://github.com/elastic/elasticsearch/blob/master/libs/grok/src/main/resources/patterns/ecs-v1/grok-patterns>https://github.com/elastic/elasticsearch/blob/master/libs/grok/src/main/resources/patterns/ecs-v1/grok-patterns</a></p><h1 id=the-flow>The flow<a hidden class=anchor aria-hidden=true href=#the-flow>#</a></h1><ol><li>Create & Test Ingest Pipeline</li><li>Index custom data</li></ol><p>Lets create the pipeline with a grok processor which is going to parse the <code>message</code> field with the document below.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;Ip&#34;</span>:<span style=color:#e6db74>&#34;1.2.3.4&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;country&#34;</span>:<span style=color:#e6db74>&#34;India&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;message&#34;</span>:<span style=color:#e6db74>&#34;LEVEL:ERROR,method:fetchUser(),message:user not found,code:123&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>I would like to extract the below data from message field and index into elasticsearch,</p><pre tabindex=0><code>&#34;method_name&#34; : &#34;fetchUser&#34;,
&#34;log_level&#34; : &#34;ERROR&#34;,
&#34;response_code&#34; : &#34;123&#34;,
&#34;message&#34; : &#34;user not found&#34;
</code></pre><h2 id=create--test-ingest-pipeline>Create & Test Ingest Pipeline<a hidden class=anchor aria-hidden=true href=#create--test-ingest-pipeline>#</a></h2><h3 id=syntax>Syntax<a hidden class=anchor aria-hidden=true href=#syntax>#</a></h3><pre tabindex=0><code>%{SYNTAX:ID}
</code></pre><p><strong>SYNTAX</strong>: It is the pattern name.<br><strong>ID</strong>: It is the key name of the document.</p><p>Data need to parse</p><pre tabindex=0><code>LEVEL:ERROR,method:fetchUser(),message:user not found
</code></pre><p>Let&rsquo;s match some of the grok patterns from the below file
<a href=https://github.com/elastic/elasticsearch/blob/master/libs/grok/src/main/resources/patterns/ecs-v1/grok-patterns>https://github.com/elastic/elasticsearch/blob/master/libs/grok/src/main/resources/patterns/ecs-v1/grok-patterns</a></p><pre tabindex=0><code>ERROR = %{LOGLEVEL:log_level}
fetchUser = %{WORD:method_name}
user not found = %{GREEDYDATA:message}
123 = code:(?&lt;response_code&gt;(?:[+-]?(?:[0-9]+)))
</code></pre><p><strong>Data</strong></p><pre tabindex=0><code>LEVEL:ERROR,method:fetchUser(),message:user not found
</code></pre><p><strong>Final Pattern</strong></p><pre tabindex=0><code>&#34;LEVEL:%{LOGLEVEL:log_level},method:%{WORD:method_name}\\(\\),message:%{GREEDYDATA:message},code:(?&lt;response_code&gt;(?:[+-]?(?:[0-9]+)))&#34;
</code></pre><blockquote><p>Note: You can add your own regex as well. For example, I have added regex for <code>code</code>.</p></blockquote><h2 id=test-pipeline>Test pipeline<a hidden class=anchor aria-hidden=true href=#test-pipeline>#</a></h2><p>For testing above pattern or pipeline we can use <a href=https://github.com/elastic/elasticsearch/blob/master/libs/grok/src/main/resources/patterns/ecs-v1/grok-patterns>Simulate Pipeline API</a> like below:</p><h4 id=_simulate>_simulate<a hidden class=anchor aria-hidden=true href=#_simulate>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>POST /_ingest/pipeline/_simulate?pretty
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;pipeline&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;description&#34;</span> : <span style=color:#e6db74>&#34;testing grok processor&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;processors&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;grok&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;field&#34;</span>: <span style=color:#e6db74>&#34;log&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;patterns&#34;</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;LEVEL:%{LOGLEVEL:log_level},method:%{WORD:method_name}\\(\\),message:%{GREEDYDATA:message},code:(?&lt;response_code&gt;(?:[+-]?(?:[0-9]+)))&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;docs&#34;</span>:<span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;_source&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;log&#34;</span>: <span style=color:#e6db74>&#34;LEVEL:ERROR,method:fetchUser(),message:user not found,code:123&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h4 id=response>Response<a hidden class=anchor aria-hidden=true href=#response>#</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;docs&#34;</span> : [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;doc&#34;</span> : {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_index&#34;</span> : <span style=color:#e6db74>&#34;_index&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_id&#34;</span> : <span style=color:#e6db74>&#34;_id&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_source&#34;</span> : {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;response_code&#34;</span> : <span style=color:#e6db74>&#34;123&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;log&#34;</span> : <span style=color:#e6db74>&#34;LEVEL:ERROR,method:fetchUser(),message:user not found,code:123&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;method_name&#34;</span> : <span style=color:#e6db74>&#34;fetchUser&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;log_level&#34;</span> : <span style=color:#e6db74>&#34;ERROR&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;message&#34;</span> : <span style=color:#e6db74>&#34;user not found&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_ingest&#34;</span> : {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;timestamp&#34;</span> : <span style=color:#e6db74>&#34;2022-04-29T14:20:59.454111422Z&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As you can see we got the desired output. Now let&rsquo;s save the pipeline.</p><h3 id=save-pipeline>Save pipeline<a hidden class=anchor aria-hidden=true href=#save-pipeline>#</a></h3><p>Pipeline can be saved using <a href=https://www.elastic.co/guide/en/elasticsearch/reference/current/ingest.html>_ingest/pipeline</a> API.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>PUT /_ingest/pipeline/custom_log?pretty
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;description&#34;</span> : <span style=color:#e6db74>&#34;testing grok processor&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;processors&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;grok&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;field&#34;</span>: <span style=color:#e6db74>&#34;log&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;patterns&#34;</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;LEVEL:%{LOGLEVEL:log_level},method:%{WORD:method_name}\\(\\),message:%{GREEDYDATA:message},code:(?&lt;response_code&gt;(?:[+-]?(?:[0-9]+)))&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><strong>Custom_log</strong>: It is the pipeline name. We need to specify the pipeline name while indexing the data.</p><h2 id=index-custom-data>Index custom data<a hidden class=anchor aria-hidden=true href=#index-custom-data>#</a></h2><p>Now let&rsquo;s index some data with the same pipeline which we created.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>POST data-stream/_doc?pipeline<span style=color:#f92672>=</span>custom_log
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;log&#34;</span> : <span style=color:#e6db74>&#34;LEVEL:INFO,method:addUser(),message:user added successfully.,code:200&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>POST data-stream/_doc?pipeline<span style=color:#f92672>=</span>custom_log
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;log&#34;</span> : <span style=color:#e6db74>&#34;LEVEL:DEBUG,method:deleteUser(),message:user_id notfound.,code:433&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>POST data-stream/_doc?pipeline<span style=color:#f92672>=</span>custom_log
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;log&#34;</span> : <span style=color:#e6db74>&#34;LEVEL:ERROR,method:fetchUser(),message:Database connection timeout,code:567&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Check all data</p><pre tabindex=0><code>GET data-stream/_search?pretty
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;took&#34;</span> : <span style=color:#ae81ff>898</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;timed_out&#34;</span> : <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;_shards&#34;</span> : {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;total&#34;</span> : <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;successful&#34;</span> : <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;skipped&#34;</span> : <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;failed&#34;</span> : <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;hits&#34;</span> : {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;total&#34;</span> : {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;value&#34;</span> : <span style=color:#ae81ff>3</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;relation&#34;</span> : <span style=color:#e6db74>&#34;eq&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;max_score&#34;</span> : <span style=color:#ae81ff>1.0</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;hits&#34;</span> : [
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_index&#34;</span> : <span style=color:#e6db74>&#34;data-stream&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_id&#34;</span> : <span style=color:#e6db74>&#34;3460dYABYeDE95hG23XJ&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_score&#34;</span> : <span style=color:#ae81ff>1.0</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_source&#34;</span> : {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;response_code&#34;</span> : <span style=color:#e6db74>&#34;200&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;log&#34;</span> : <span style=color:#e6db74>&#34;LEVEL:INFO,method:addUser(),message:user added successfully.,code:200&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;method_name&#34;</span> : <span style=color:#e6db74>&#34;addUser&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;log_level&#34;</span> : <span style=color:#e6db74>&#34;INFO&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;message&#34;</span> : <span style=color:#e6db74>&#34;user added successfully.&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_index&#34;</span> : <span style=color:#e6db74>&#34;data-stream&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_id&#34;</span> : <span style=color:#e6db74>&#34;Kwi2dYABbuPmoOiCSUjL&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_score&#34;</span> : <span style=color:#ae81ff>1.0</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_source&#34;</span> : {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;response_code&#34;</span> : <span style=color:#e6db74>&#34;433&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;log&#34;</span> : <span style=color:#e6db74>&#34;LEVEL:DEBUG,method:deleteUser(),message:user_id notfound.,code:433&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;method_name&#34;</span> : <span style=color:#e6db74>&#34;deleteUser&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;log_level&#34;</span> : <span style=color:#e6db74>&#34;DEBUG&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;message&#34;</span> : <span style=color:#e6db74>&#34;user_id notfound.&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_index&#34;</span> : <span style=color:#e6db74>&#34;data-stream&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_id&#34;</span> : <span style=color:#e6db74>&#34;LAi4dYABbuPmoOiCmUgb&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_score&#34;</span> : <span style=color:#ae81ff>1.0</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_source&#34;</span> : {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;response_code&#34;</span> : <span style=color:#e6db74>&#34;567&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;log&#34;</span> : <span style=color:#e6db74>&#34;LEVEL:ERROR,method:fetchUser(),message:Database connection timeout,code:567&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;method_name&#34;</span> : <span style=color:#e6db74>&#34;fetchUser&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;log_level&#34;</span> : <span style=color:#e6db74>&#34;ERROR&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;message&#34;</span> : <span style=color:#e6db74>&#34;Database connection timeout&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=parsing-common-log-format>Parsing common log format<a hidden class=anchor aria-hidden=true href=#parsing-common-log-format>#</a></h1><p>Common log format is standard format for logging which is used by webservers and system log generators etc.</p><p>Let&rsquo;s say we having below log:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>97.92.139.153 <span style=color:#ae81ff>1254</span> ashishtiwari <span style=color:#f92672>[</span>04/Mar/2022:15:18:55 +0530<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;GET /niches HTTP/1.1&#34;</span> <span style=color:#ae81ff>201</span> <span style=color:#ae81ff>2322</span>
</span></span></code></pre></div><h2 id=grok-pattern-1>Grok Pattern<a hidden class=anchor aria-hidden=true href=#grok-pattern-1>#</a></h2><p><img loading=lazy src=https://ashish.one/img/misc/parse-custom-log.png alt="Common log format grok pattern"></p><h2 id=final-grok-pattern>Final Grok Pattern<a hidden class=anchor aria-hidden=true href=#final-grok-pattern>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>%<span style=color:#f92672>{</span>IPORHOST:ip<span style=color:#f92672>}</span> %<span style=color:#f92672>{</span>USER:user_id<span style=color:#f92672>}</span> %<span style=color:#f92672>{</span>USERNAME:username<span style=color:#f92672>}</span> <span style=color:#ae81ff>\\</span><span style=color:#f92672>[</span>%<span style=color:#f92672>{</span>HTTPDATE:date<span style=color:#f92672>}</span><span style=color:#ae81ff>\\</span><span style=color:#f92672>]</span> <span style=color:#ae81ff>\&#34;</span>%<span style=color:#f92672>{</span>WORD:request.method<span style=color:#f92672>}</span> %<span style=color:#f92672>{</span>URIPATH:request.path<span style=color:#f92672>}</span> %<span style=color:#f92672>{</span>URIPROTO:request.proto<span style=color:#f92672>}</span>/%<span style=color:#f92672>{</span>NUMBER:request.http_version<span style=color:#f92672>}</span><span style=color:#ae81ff>\&#34;</span> %<span style=color:#f92672>{</span>NUMBER:request.response<span style=color:#f92672>}</span> %<span style=color:#f92672>{</span>NUMBER:request.size_bytes<span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=_simulate-1>_simulate<a hidden class=anchor aria-hidden=true href=#_simulate-1>#</a></h2><p>Lets simulate the pipeline with above grok pattern</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>POST /_ingest/pipeline/_simulate?pretty
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;pipeline&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;description&#34;</span> : <span style=color:#e6db74>&#34;testing grok processor&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;processors&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;grok&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;field&#34;</span>: <span style=color:#e6db74>&#34;log&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;patterns&#34;</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;%{IPORHOST:ip} %{USER:user_id} %{USERNAME:username} \\[%{HTTPDATE:date}\\] \&#34;%{WORD:request.method} %{URIPATH:request.path} %{URIPROTO:request.proto}/%{NUMBER:request.http_version}\&#34; %{NUMBER:request.response} %{NUMBER:request.size_bytes}&#34;</span><span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;docs&#34;</span>:<span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;_source&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;log&#34;</span>: <span style=color:#e6db74>&#34;97.92.139.153 1254 ashishtiwari [04/Mar/2022:15:18:55 +0530] \&#34;GET /niches HTTP/1.1\&#34; 201 2322&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=response-1>Response<a hidden class=anchor aria-hidden=true href=#response-1>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;docs&#34;</span> : [
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;doc&#34;</span> : {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_index&#34;</span> : <span style=color:#e6db74>&#34;_index&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_id&#34;</span> : <span style=color:#e6db74>&#34;_id&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_source&#34;</span> : {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;date&#34;</span> : <span style=color:#e6db74>&#34;04/Mar/2022:15:18:55 +0530&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;request&#34;</span> : {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;path&#34;</span> : <span style=color:#e6db74>&#34;/niches&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;size_bytes&#34;</span> : <span style=color:#e6db74>&#34;2322&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;method&#34;</span> : <span style=color:#e6db74>&#34;GET&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;response&#34;</span> : <span style=color:#e6db74>&#34;201&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;proto&#34;</span> : <span style=color:#e6db74>&#34;HTTP&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;http_version&#34;</span> : <span style=color:#e6db74>&#34;1.1&#34;</span>
</span></span><span style=display:flex><span>          },
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;log&#34;</span> : <span style=color:#e6db74>&#34;&#34;&#34;97.92.139.153 1254 ashishtiwari [04/Mar/2022:15:18:55 +0530] &#34;</span><span style=color:#960050;background-color:#1e0010>GET</span> <span style=color:#960050;background-color:#1e0010>/niches</span> <span style=color:#960050;background-color:#1e0010>HTTP/</span><span style=color:#ae81ff>1.1</span><span style=color:#e6db74>&#34; 201 2322&#34;&#34;&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;user_id&#34;</span> : <span style=color:#e6db74>&#34;1254&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;ip&#34;</span> : <span style=color:#e6db74>&#34;97.92.139.153&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;username&#34;</span> : <span style=color:#e6db74>&#34;ashishtiwari&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;_ingest&#34;</span> : {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;timestamp&#34;</span> : <span style=color:#e6db74>&#34;2022-04-29T14:42:51.765427484Z&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As we can see it successfully parsed the data. You can save the pipeline and index the data as shown on the above steps.</p><p>Similarly you can parse any log format with Grok pattern.</p><h1 id=demo>Demo<a hidden class=anchor aria-hidden=true href=#demo>#</a></h1><p>You can also check the demo on the below link where I presented how you can parse common log format using ingest pipeline and grok processor.</p><p><a href=https://ashish.one/talks/devops-conf-2022/>https://ashish.one/talks/devops-conf-2022/</a></p><h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h1><p>We have seen how we can parse any types of log format into elasticsearch with the help of ingest pipeline & grok processor. You can also use this ingest pipeline with filebeat or logstash. Where you just need to specify the pipeline name.</p><p>Feel free to put in comments if you have any doubts.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://ashish.one/tags/elasticsearch/>elasticsearch</a></li><li><a href=https://ashish.one/tags/grok-processor/>grok-processor</a></li><li><a href=https://ashish.one/tags/grok-pattern/>grok-pattern</a></li><li><a href=https://ashish.one/tags/ingest-pipeline/>ingest-pipeline</a></li><li><a href=https://ashish.one/tags/elastic/>Elastic</a></li></ul><nav class=paginav><a class=prev href=https://ashish.one/blogs/elastic-docker-compose/><span class=title>« Prev</span><br><span>Start a single node elastic cluster with Docker Compose</span></a>
<a class=next href=https://ashish.one/blogs/search-as-you-type/><span class=title>Next »</span><br><span>[Part -1] Search as you type</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Parsing Custom log format to the Elasticsearch on twitter" href="https://twitter.com/intent/tweet/?text=Parsing%20Custom%20log%20format%20to%20the%20Elasticsearch&url=https%3a%2f%2fashish.one%2fblogs%2fparsing-custom-log-format-to-the-elasticsearch%2f&hashtags=elasticsearch%2cgrok-processor%2cgrok-pattern%2cingest-pipeline%2cElastic"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Parsing Custom log format to the Elasticsearch on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fashish.one%2fblogs%2fparsing-custom-log-format-to-the-elasticsearch%2f&title=Parsing%20Custom%20log%20format%20to%20the%20Elasticsearch&summary=Parsing%20Custom%20log%20format%20to%20the%20Elasticsearch&source=https%3a%2f%2fashish.one%2fblogs%2fparsing-custom-log-format-to-the-elasticsearch%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Parsing Custom log format to the Elasticsearch on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fashish.one%2fblogs%2fparsing-custom-log-format-to-the-elasticsearch%2f&title=Parsing%20Custom%20log%20format%20to%20the%20Elasticsearch"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Parsing Custom log format to the Elasticsearch on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fashish.one%2fblogs%2fparsing-custom-log-format-to-the-elasticsearch%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Parsing Custom log format to the Elasticsearch on whatsapp" href="https://api.whatsapp.com/send?text=Parsing%20Custom%20log%20format%20to%20the%20Elasticsearch%20-%20https%3a%2f%2fashish.one%2fblogs%2fparsing-custom-log-format-to-the-elasticsearch%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Parsing Custom log format to the Elasticsearch on telegram" href="https://telegram.me/share/url?text=Parsing%20Custom%20log%20format%20to%20the%20Elasticsearch&url=https%3a%2f%2fashish.one%2fblogs%2fparsing-custom-log-format-to-the-elasticsearch%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><script src=https://giscus.app/client.js data-repo=ashishtiwari1993/ashish.one data-repo-id="MDEwOlJlcG9zaXRvcnkyMTAxMjkzNjY=" data-category=General data-category-id=DIC_kwDODIZR1s4CP1P2 data-mapping=title data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=dark_high_contrast data-lang=en crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://ashish.one/>ashish.one</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>